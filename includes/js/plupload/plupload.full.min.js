(function(F,r){function G(f,d){for(var a,b=[],e=0;e<f.length;++e){if(!(a=y[f[e]]))a:{a=F;for(var h=f[e].split(/[.\/]/),c=0;c<h.length;++c){if(!a[h[c]]){a=void 0;break a}a=a[h[c]]}}if(!a)throw"module definition dependecy not found: "+f[e];b.push(a)}d.apply(null,b)}function q(f,d,a){if("string"!==typeof f)throw"invalid module definition, module id must be defined and be a string";if(void 0===d)throw"invalid module definition, dependencies must be specified";if(void 0===a)throw"invalid module definition, definition function must be specified";
G(d,function(){y[f]=a.apply(null,arguments)})}var y={};q("moxie/core/utils/Basic",[],function(){var f=function(e){return void 0===e?"undefined":null===e?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},d=function(e){a(arguments,function(h,c){0<c&&a(h,function(c,a){void 0!==c&&(f(e[a])===f(c)&&~b(f(c),["array","object"])?d(e[a],c):e[a]=c)})});return e},a=function(e,b){var c,a;if(e){try{c=e.length}catch(d){c=void 0}if(void 0===c)for(a in e){if(e.hasOwnProperty(a)&&
!1===b(e[a],a))break}else for(a=0;a<c&&!1!==b(e[a],a);a++);}},b=function(b,a){if(a){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c}return-1};return{guid:function(){var b=0;return function(a){var c=(new Date).getTime().toString(32),d;for(d=0;5>d;d++)c+=Math.floor(65535*Math.random()).toString(32);return(a||"o_")+c+(b++).toString(32)}}(),typeOf:f,extend:d,each:a,isEmptyObj:function(b){var a;if(!b||"object"!==f(b))return!0;for(a in b)return!1;
return!0},inSeries:function(b,a){function c(k){if("function"===f(b[k]))b[k](function(b){++k<d&&!b?c(k):a(b)})}var d=b.length;"function"!==f(a)&&(a=function(){});b&&b.length||a();c(0)},inParallel:function(b,d){var c=0,g=b.length,k=Array(g);a(b,function(b,e){b(function(b){if(b)return d(b);var a=[].slice.call(arguments);a.shift();k[e]=a;c++;c===g&&(k.unshift(null),d.apply(this,k))})})},inArray:b,arrayDiff:function(e,a){var c=[];"array"!==f(e)&&(e=[e]);"array"!==f(a)&&(a=[a]);for(var d in e)-1===b(e[d],
a)&&c.push(e[d]);return c.length?c:!1},arrayIntersect:function(e,d){var c=[];a(e,function(e){-1!==b(e,d)&&c.push(e)});return c.length?c:null},toArray:function(b){var a,c=[];for(a=0;a<b.length;a++)c[a]=b[a];return c},trim:function(b){return b?String.prototype.trim?String.prototype.trim.call(b):b.toString().replace(/^\s*/,"").replace(/\s*$/,""):b},parseSizeStr:function(b){if("string"!==typeof b)return b;var a={t:1099511627776,g:1073741824,m:1048576,k:1024},c;b=/^([0-9]+)([mgk]?)$/.exec(b.toLowerCase().replace(/[^0-9mkg]/g,
""));c=b[2];b=+b[1];a.hasOwnProperty(c)&&(b*=a[c]);return b}}});q("moxie/core/I18n",["moxie/core/utils/Basic"],function(f){var d={};return{addI18n:function(a){return f.extend(d,a)},translate:function(a){return d[a]||a},_:function(a){return this.translate(a)},sprintf:function(a){var b=[].slice.call(arguments,1);return a.replace(/%[a-z]/g,function(){var e=b.shift();return"undefined"!==f.typeOf(e)?e:""})}}});q("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(f,d){var a={mimes:{},
extensions:{},addMimeType:function(b){b=b.split(/,/);var e,a,c;for(e=0;e<b.length;e+=2){c=b[e+1].split(/ /);for(a=0;a<c.length;a++)this.mimes[c[a]]=b[e];this.extensions[b[e]]=c}},extList2mimes:function(b,e){var a,c,d,k,p=[];for(c=0;c<b.length;c++)for(a=b[c].extensions.split(/\s*,\s*/),d=0;d<a.length;d++){if("*"===a[d])return[];if(k=this.mimes[a[d]])-1===f.inArray(k,p)&&p.push(k);else if(e&&/^\w+$/.test(a[d]))p.push("."+a[d]);else return[]}return p},mimes2exts:function(b){var a=this,d=[];f.each(b,
function(b){if("*"===b)return d=[],!1;var g=b.match(/^(\w+)\/(\*|\w+)$/);g&&("*"===g[2]?f.each(a.extensions,function(b,c){(new RegExp("^"+g[1]+"/")).test(c)&&[].push.apply(d,a.extensions[c])}):a.extensions[b]&&[].push.apply(d,a.extensions[b]))});return d},mimes2extList:function(b){var a=[],h=[];"string"===f.typeOf(b)&&(b=f.trim(b).split(/\s*,\s*/));h=this.mimes2exts(b);a.push({title:d.translate("Files"),extensions:h.length?h.join(","):"*"});a.mimes=b;return a},getFileExtension:function(b){return(b=
b&&b.match(/\.([^.]+)$/))?b[1].toLowerCase():""},getFileMime:function(b){return this.mimes[this.getFileExtension(b)]||""}};a.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");
return a});q("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(f){var d=function(b){var a={has:function(b,a){return-1!==a.toLowerCase().indexOf(b.toLowerCase())},lowerize:function(b){return b.toLowerCase()}},d=function(){for(var a,e=0,c,d,k,h,g,l=arguments;e<l.length;e+=2){g=l[e];var f=l[e+1];if("undefined"===typeof a)for(k in a={},f)c=f[k],"object"===typeof c?a[c[0]]=b:a[c]=b;for(c=d=0;c<g.length;c++)if(h=g[c].exec(this.getUA())){for(k=0;k<f.length;k++)g=h[++d],c=f[k],"object"===typeof c&&
0<c.length?2==c.length?a[c[0]]="function"==typeof c[1]?c[1].call(this,g):c[1]:3==c.length?a[c[0]]="function"!==typeof c[1]||c[1].exec&&c[1].test?g?g.replace(c[1],c[2]):b:g?c[1].call(this,g,c[2]):b:4==c.length&&(a[c[0]]=g?c[3].call(this,g.replace(c[1],c[2])):b):a[c]=g?g:b;break}if(h)break}return a},c=function(c,d){for(var k in d)if("object"===typeof d[k]&&0<d[k].length)for(var g=0;g<d[k].length;g++){if(a.has(d[k][g],c))return"?"===k?b:k}else if(a.has(d[k],c))return"?"===k?b:k;return c},g={ME:"4.90",
"NT 3.11":"NT3.51","NT 4.0":"NT4.0",2E3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",RT:"ARM"},k=[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],["name","version","major"],[/\s(opr)\/((\d+)?[\w\.]+)/i],[["name","Opera"],"version","major"],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,
/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],["name","version","major"],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[["name","IE"],"version","major"],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[["name","Yandex"],"version","major"],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[["name",/_/g," "],"version","major"],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],["name","version",
"major"],[/(dolfin)\/((\d+)?[\w\.]+)/i],[["name","Dolphin"],"version","major"],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[["name","Chrome"],"version","major"],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[["name","Android Browser"],"version","major"],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],["version","major",["name","Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],["version","major","name"],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],
["name",["major",c,{1:["/8","/1","/3"],2:"/4","?":"/"}],["version",c,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],["name","version","major"],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[["name","Netscape"],"version","major"],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,
/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],["name","version","major"]],f=[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],["name","version"],[/rv\:([\w\.]+).*(gecko)/i],
["version","name"]],l=[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],["name",["version",c,g]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[["name","Windows"],["version",c,g]],[/\((bb)(10);/i],[["name","BlackBerry"],"version"],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],["name","version"],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[["name",
"Symbian"],"version"],[/mozilla.+\(mobile;.+gecko.+firefox/i],[["name","Firefox OS"],"version"],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],["name","version"],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[["name","Chromium OS"],"version"],[/(sunos)\s?([\w\.]+\d)*/i],[["name","Solaris"],"version"],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],
["name","version"],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[["name","iOS"],["version",/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],["name",["version",/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],["name","version"]];return(new function(b){var a=b||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"");this.getBrowser=function(){return d.apply(this,
k)};this.getEngine=function(){return d.apply(this,f)};this.getOS=function(){return d.apply(this,l)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return a};this.setUA=function(b){a=b;return this};this.setUA(a)}).getResult()}(),a={can:function(){var b={define_property:!1,create_canvas:function(){var b=document.createElement("canvas");return!(!b.getContext||!b.getContext("2d"))}(),return_response_type:function(b){try{if(-1!==
f.inArray(b,["","text","document"]))return!0;if(window.XMLHttpRequest){var a=new XMLHttpRequest;a.open("get","/");if("responseType"in a)return a.responseType=b,a.responseType!==b?!1:!0}}catch(c){}return!1},use_data_uri:function(){var a=new Image;a.onload=function(){b.use_data_uri=1===a.width&&1===a.height};setTimeout(function(){a.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);return!1}(),use_data_uri_over32kb:function(){return b.use_data_uri&&("IE"!==
a.browser||9<=a.version)},use_data_uri_of:function(a){return b.use_data_uri&&33E3>a||b.use_data_uri_over32kb()},use_fileinput:function(){var b=document.createElement("input");b.setAttribute("type","file");return!b.disabled}};return function(a){var d=[].slice.call(arguments);d.shift();return"function"===f.typeOf(b[a])?b[a].apply(this,d):!!b[a]}}(),browser:d.browser.name,version:parseFloat(d.browser.major),os:d.os.name,osVersion:d.os.version,verComp:function(b,a,d){var c=0,g=0,k=0,f={dev:-6,alpha:-5,
a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},c=function(b){b=(""+b).replace(/[_\-+]/g,".");b=b.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".");return b.length?b.split("."):[-8]},l=function(b){return b?isNaN(b)?f[b]||-7:parseInt(b,10):0};b=c(b);a=c(a);g=Math.max(b.length,a.length);for(c=0;c<g;c++)if(b[c]!=a[c])if(b[c]=l(b[c]),a[c]=l(a[c]),b[c]<a[c]){k=-1;break}else if(b[c]>a[c]){k=1;break}if(!d)return k;switch(d){case ">":case "gt":return 0<k;case ">=":case "ge":return 0<=k;case "<=":case "le":return 0>=
k;case "==":case "=":case "eq":return 0===k;case "<>":case "!=":case "ne":return 0!==k;case "":case "<":case "lt":return 0>k;default:return null}},swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};a.OS=a.os;return a});q("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(f){var d=function(a,b){return a.className?(new RegExp("(^|\\s+)"+b+"(\\s+|$)")).test(a.className):!1};return{get:function(a){return"string"!==
typeof a?a:document.getElementById(a)},hasClass:d,addClass:function(a,b){d(a,b)||(a.className=a.className?a.className.replace(/\s+$/,"")+" "+b:b)},removeClass:function(a,b){a.className&&(a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)"),function(b,a,c){return" "===a&&" "===c?" ":""}))},getStyle:function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return window.getComputedStyle(a,null)[b]},getPos:function(a,b){function e(b){var a,c=0;a=0;b&&(a=b.getBoundingClientRect(),
b="CSS1Compat"===k.compatMode?k.documentElement:k.body,c=a.left+b.scrollLeft,a=a.top+b.scrollTop);return{x:c,y:a}}var d=0,c=0,g,k=document;b=b||k.body;if(a&&a.getBoundingClientRect&&"IE"===f.browser&&(!k.documentMode||8>k.documentMode))return d=e(a),c=e(b),{x:d.x-c.x,y:d.y-c.y};for(g=a;g&&g!=b&&g.nodeType;)d+=g.offsetLeft||0,c+=g.offsetTop||0,g=g.offsetParent;for(g=a.parentNode;g&&g!=b&&g.nodeType;)d-=g.scrollLeft||0,c-=g.scrollTop||0,g=g.parentNode;return{x:d,y:c}},getSize:function(a){return{w:a.offsetWidth||
a.clientWidth,h:a.offsetHeight||a.clientHeight}}}});q("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(f){function d(a,b){for(var e in a)if(a[e]===b)return e;return null}return{RuntimeError:function(){function a(a){this.code=a;this.name=d(b,a);this.message=this.name+": RuntimeError "+this.code}var b={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};f.extend(a,b);a.prototype=Error.prototype;return a}(),OperationNotAllowedException:function(){function a(b){this.code=b;this.name="OperationNotAllowedException"}
f.extend(a,{NOT_ALLOWED_ERR:1});a.prototype=Error.prototype;return a}(),ImageError:function(){function a(a){this.code=a;this.name=d(b,a);this.message=this.name+": ImageError "+this.code}var b={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};f.extend(a,b);a.prototype=Error.prototype;return a}(),FileException:function(){function a(a){this.code=a;this.name=d(b,a);this.message=this.name+": FileException "+this.code}var b={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,
INVALID_STATE_ERR:7,SYNTAX_ERR:8};f.extend(a,b);a.prototype=Error.prototype;return a}(),DOMException:function(){function a(a){this.code=a;this.name=d(b,a);this.message=this.name+": DOMException "+this.code}var b={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,
INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};f.extend(a,b);a.prototype=Error.prototype;return a}(),EventException:function(){function a(b){this.code=b;this.name="EventException"}f.extend(a,{UNSPECIFIED_EVENT_TYPE_ERR:0});a.prototype=Error.prototype;return a}()}});q("moxie/core/EventTarget",["moxie/core/Exceptions","moxie/core/utils/Basic"],
function(f,d){function a(){var b={};d.extend(this,{uid:null,init:function(){this.uid||(this.uid=d.guid("uid_"))},addEventListener:function(a,h,c,g){var k=this,f;a=d.trim(a);/\s/.test(a)?d.each(a.split(/\s+/),function(b){k.addEventListener(b,h,c,g)}):(a=a.toLowerCase(),c=parseInt(c,10)||0,f=b[this.uid]&&b[this.uid][a]||[],f.push({fn:h,priority:c,scope:g||this}),b[this.uid]||(b[this.uid]={}),b[this.uid][a]=f)},hasEventListener:function(a){return a?!(!b[this.uid]||!b[this.uid][a]):!!b[this.uid]},removeEventListener:function(a,
h){a=a.toLowerCase();var c=b[this.uid]&&b[this.uid][a],g;if(c){if(h)for(g=c.length-1;0<=g;g--){if(c[g].fn===h){c.splice(g,1);break}}else c=[];c.length||(delete b[this.uid][a],d.isEmptyObj(b[this.uid])&&delete b[this.uid])}},removeAllEventListeners:function(){b[this.uid]&&delete b[this.uid]},dispatchEvent:function(a){var h,c,g,k={},p=!0;if("string"!==d.typeOf(a))if(c=a,"string"===d.typeOf(c.type))a=c.type,void 0!==c.total&&void 0!==c.loaded&&(k.total=c.total,k.loaded=c.loaded),k.async=c.async||!1;
else throw new f.EventException(f.EventException.UNSPECIFIED_EVENT_TYPE_ERR);-1!==a.indexOf("::")?function(b){h=b[0];a=b[1]}(a.split("::")):h=this.uid;a=a.toLowerCase();if(c=b[h]&&b[h][a]){c.sort(function(b,a){return a.priority-b.priority});g=[].slice.call(arguments);g.shift();k.type=a;g.unshift(k);var l=[];d.each(c,function(b){g[0].target=b.scope;k.async?l.push(function(a){setTimeout(function(){a(!1===b.fn.apply(b.scope,g))},1)}):l.push(function(a){a(!1===b.fn.apply(b.scope,g))})});l.length&&d.inSeries(l,
function(b){p=!b})}return p},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(b){var a;"array"!==d.typeOf(b)&&(b=[b]);for(var c=0;c<b.length;c++)a="on"+b[c],"function"===d.typeOf(this[a])?this.addEventListener(b[c],this[a]):"undefined"===d.typeOf(this[a])&&
(this[a]=null)}})}a.instance=new a;return a});q("moxie/core/utils/Encode",[],function(){var f=function(a){return unescape(encodeURIComponent(a))},d=function(a){return decodeURIComponent(escape(a))};return{utf8_encode:f,utf8_decode:d,atob:function(a,b){if("function"===typeof window.atob)return b?d(window.atob(a)):window.atob(a);var e,f,c,g,k,p=0,l=0;g="";var n=[];if(!a)return a;a+="";do e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(p++)),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(p++)),
g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(p++)),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(p++)),c=e<<18|f<<12|g<<6|k,e=c>>16&255,f=c>>8&255,c&=255,64==g?n[l++]=String.fromCharCode(e):64==k?n[l++]=String.fromCharCode(e,f):n[l++]=String.fromCharCode(e,f,c);while(p<a.length);g=n.join("");return b?d(g):g},btoa:function(a,b){b&&f(a);if("function"===typeof window.btoa)return window.btoa(a);var d,h,c,g,k=0,p=0,l="",
l=[];if(!a)return a;do d=a.charCodeAt(k++),h=a.charCodeAt(k++),c=a.charCodeAt(k++),g=d<<16|h<<8|c,d=g>>18&63,h=g>>12&63,c=g>>6&63,g&=63,l[p++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g);while(k<a.length);l=l.join("");k=a.length%3;return(k?
l.slice(0,k-3):l)+"===".slice(k||3)}}});q("moxie/runtime/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(f,d,a){function b(a,e,k,p,l){var n=this,u,m=f.guid(e+"_");l=l||"browser";a=a||{};h[m]=this;k=f.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,
select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},k);a.preferred_caps&&(l=b.getMode(p,a.preferred_caps,l));u=function(){var b={};return{exec:function(a,c,d,e){if(u[c]&&(b[a]||(b[a]={context:this,instance:new u[c]}),b[a].instance[d]))return b[a].instance[d].apply(this,e)},removeInstance:function(a){delete b[a]},removeAllInstances:function(){var a=this;f.each(b,
function(b,c){"function"===f.typeOf(b.instance.destroy)&&b.instance.destroy.call(b.context);a.removeInstance(c)})}}}();f.extend(this,{initialized:!1,uid:m,type:e,mode:b.getMode(p,a.required_caps,l),shimid:m+"_container",clients:0,options:a,can:function(a,c,d){d=d||k;"string"===f.typeOf(a)&&"undefined"===f.typeOf(c)&&(a=b.parseCaps(a));if("object"===f.typeOf(a)){for(var e in a)if(!this.can(e,a[e],d))return!1;return!0}return"function"===f.typeOf(d[a])?d[a].call(this,c):c===d[a]},getShimContainer:function(){var b,
a=d.get(this.shimid);a||(b=this.options.container?d.get(this.options.container):document.body,a=document.createElement("div"),a.id=this.shimid,a.className="moxie-shim moxie-shim-"+this.type,f.extend(a.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),b.appendChild(a));return a},getShim:function(){return u},shimExec:function(b,a){var c=[].slice.call(arguments,2);return n.getShim().exec.call(this,this.uid,b,a,c)},exec:function(b,a){var c=[].slice.call(arguments,
2);return n[b]&&n[b][a]?n[b][a].apply(this,c):n.shimExec.apply(this,arguments)},destroy:function(){if(n){var b=d.get(this.shimid);b&&b.parentNode.removeChild(b);u&&u.removeAllInstances();this.unbindAll();delete h[this.uid];m=n=u=this.uid=null}}});this.mode&&a.required_caps&&!this.can(a.required_caps)&&(this.mode=!1)}var e={},h={};b.order="html5,flash,silverlight,html4";b.getRuntime=function(b){return h[b]?h[b]:!1};b.addConstructor=function(b,d){d.prototype=a.instance;e[b]=d};b.getConstructor=function(b){return e[b]||
null};b.getInfo=function(a){var d=b.getRuntime(a);return d?{uid:d.uid,type:d.type,mode:d.mode,can:function(){return d.can.apply(d,arguments)}}:null};b.parseCaps=function(b){var a={};if("string"!==f.typeOf(b))return b||{};f.each(b.split(","),function(b){a[b]=!0});return a};b.can=function(a,d){var e;e=b.getConstructor(a);var f;return e?(e=new e({required_caps:d}),f=e.mode,e.destroy(),!!f):!1};b.thatCan=function(a,d){var e=(d||b.order).split(/\s*,\s*/),f;for(f in e)if(b.can(e[f],a))return e[f];return null};
b.getMode=function(b,a,d){var e=null;"undefined"===f.typeOf(d)&&(d="browser");if(a&&!f.isEmptyObj(b)){f.each(a,function(a,d){if(b.hasOwnProperty(d)){var k=b[d](a);"string"===typeof k&&(k=[k]);if(!e)e=k;else if(!(e=f.arrayIntersect(e,k)))return e=!1}});if(e)return-1!==f.inArray(d,e)?d:e[0];if(!1===e)return!1}return d};b.capTrue=function(){return!0};b.capFalse=function(){return!1};b.capTest=function(b){return function(){return!!b}};return b});q("moxie/runtime/RuntimeClient",["moxie/core/Exceptions",
"moxie/core/utils/Basic","moxie/runtime/Runtime"],function(f,d,a){return function(){var b;d.extend(this,{connectRuntime:function(e){function h(d){var g;d.length?(g=d.shift(),(g=a.getConstructor(g))?(b=new g(e),b.bind("Init",function(){b.initialized=!0;setTimeout(function(){b.clients++;c.trigger("RuntimeInit",b)},1)}),b.bind("Error",function(){b.destroy();h(d)}),b.mode?b.init():b.trigger("Error")):h(d)):(c.trigger("RuntimeError",new f.RuntimeError(f.RuntimeError.NOT_INIT_ERR)),b=null)}var c=this,g;
"string"===d.typeOf(e)?g=e:"string"===d.typeOf(e.ruid)&&(g=e.ruid);if(g){if(b=a.getRuntime(g))return b.clients++,b;throw new f.RuntimeError(f.RuntimeError.NOT_INIT_ERR);}h((e.runtime_order||a.order).split(/\s*,\s*/))},getRuntime:function(){return b&&b.uid?b:b=null},disconnectRuntime:function(){b&&0>=--b.clients&&(b.destroy(),b=null)}})}});q("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(f,d,a){function b(h,c){function g(a,c,d){var g=e[this.uid];
if("string"!==f.typeOf(g)||!g.length)return null;c=new b(null,{type:d,size:c-a});c.detach(g.substr(a,c.size));return c}a.call(this);h&&this.connectRuntime(h);c?"string"===f.typeOf(c)&&(c={data:c}):c={};f.extend(this,{uid:c.uid||f.guid("uid_"),ruid:h,size:c.size||0,type:c.type||"",slice:function(b,a,c){return this.isDetached()?g.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),b,a,c)},getSource:function(){return e[this.uid]?e[this.uid]:null},detach:function(b){this.ruid&&
(this.getRuntime().exec.call(this,"Blob","destroy",e[this.uid]),this.disconnectRuntime(),this.ruid=null);b=b||"";var a=b.match(/^data:([^;]*);base64,/);a&&(this.type=a[1],b=d.atob(b.substring(b.indexOf("base64,")+7)));this.size=b.length;e[this.uid]=b},isDetached:function(){return!this.ruid&&"string"===f.typeOf(e[this.uid])},destroy:function(){this.detach();delete e[this.uid]}});c.data?this.detach(c.data):e[this.uid]=c}var e={};return b});q("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime",
"moxie/file/Blob"],function(f,d,a){function b(b,h){var c,g;h||(h={});g=h.type&&""!==h.type?h.type:d.getFileMime(h.name);h.name?(c=h.name.replace(/\\/g,"/"),c=c.substr(c.lastIndexOf("/")+1)):(c=g.split("/")[0],c=f.guid((""!==c?c:"file")+"_"),d.extensions[g]&&(c+="."+d.extensions[g][0]));a.apply(this,arguments);f.extend(this,{type:g||"",name:c||f.guid("file_"),lastModifiedDate:h.lastModifiedDate||(new Date).toLocaleString()})}b.prototype=a.prototype;return b});q("moxie/file/FileInput","moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/I18n moxie/file/File moxie/runtime/Runtime moxie/runtime/RuntimeClient".split(" "),
function(f,d,a,b,e,h,c,g,k){function p(e){var p=this,m;-1!==f.inArray(f.typeOf(e),["string","node"])&&(e={browse_button:e});m=a.get(e.browse_button);if(!m)throw new b.DOMException(b.DOMException.NOT_FOUND_ERR);m={accept:[{title:h.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:m.parentNode||document.body};e=f.extend({},m,e);"string"===typeof e.required_caps&&(e.required_caps=g.parseCaps(e.required_caps));"string"===typeof e.accept&&(e.accept=d.mimes2extList(e.accept));
m=a.get(e.container);m||(m=document.body);"static"===a.getStyle(m,"position")&&(m.style.position="relative");m=m=null;k.call(p);f.extend(p,{uid:f.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){p.convertEventPropsToHandlers(l);p.bind("RuntimeInit",function(b,d){p.ruid=d.uid;p.shimid=d.shimid;p.bind("Ready",function(){p.trigger("Refresh")},999);p.bind("Change",function(){var b=d.exec.call(p,"FileInput","getFiles");p.files=[];f.each(b,function(b){if(0===b.size)return!0;p.files.push(new c(p.ruid,
b))})},999);p.bind("Refresh",function(){var b,c,k;c=a.get(e.browse_button);k=a.get(d.shimid);c&&(b=a.getPos(c,a.get(e.container)),c=a.getSize(c),k&&f.extend(k.style,{top:b.y+"px",left:b.x+"px",width:c.w+"px",height:c.h+"px"}))});d.exec.call(p,"FileInput","init",e)});p.connectRuntime(f.extend({},e,{required_caps:{select_file:!0}}))},disable:function(b){var a=this.getRuntime();a&&a.exec.call(this,"FileInput","disable","undefined"===f.typeOf(b)?!0:b)},refresh:function(){p.trigger("Refresh")},destroy:function(){var b=
this.getRuntime();b&&(b.exec.call(this,"FileInput","destroy"),this.disconnectRuntime());"array"===f.typeOf(this.files)&&f.each(this.files,function(b){b.destroy()});this.files=null}})}var l="ready change cancel mouseenter mouseleave mousedown mouseup".split(" ");p.prototype=e.instance;return p});q("moxie/file/FileDrop","moxie/core/I18n moxie/core/utils/Dom moxie/core/Exceptions moxie/core/utils/Basic moxie/file/File moxie/runtime/RuntimeClient moxie/core/EventTarget moxie/core/utils/Mime".split(" "),
function(f,d,a,b,e,h,c,g){function k(a){var c=this,k;"string"===typeof a&&(a={drop_zone:a});k={accept:[{title:f.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};a="object"===typeof a?b.extend({},k,a):k;a.container=d.get(a.drop_zone)||document.body;"static"===d.getStyle(a.container,"position")&&(a.container.style.position="relative");"string"===typeof a.accept&&(a.accept=g.mimes2extList(a.accept));h.call(c);b.extend(c,{uid:b.guid("uid_"),ruid:null,files:null,init:function(){c.convertEventPropsToHandlers(p);
c.bind("RuntimeInit",function(d,k){c.ruid=k.uid;c.bind("Drop",function(){var a=k.exec.call(c,"FileDrop","getFiles");c.files=[];b.each(a,function(b){c.files.push(new e(c.ruid,b))})},999);k.exec.call(c,"FileDrop","init",a);c.dispatchEvent("ready")});c.connectRuntime(a)},destroy:function(){var b=this.getRuntime();b&&(b.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime());this.files=null}})}var p=["ready","dragenter","dragleave","drop","error"];k.prototype=c.instance;return k});q("moxie/runtime/RuntimeTarget",
["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(f,d,a){function b(){this.uid=f.guid("uid_");d.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}b.prototype=a.instance;return b});q("moxie/file/FileReader","moxie/core/utils/Basic moxie/core/utils/Encode moxie/core/Exceptions moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/runtime/RuntimeTarget".split(" "),function(f,d,a,b,e,h,c){function g(){function b(f,p){function w(b){h.readyState=
g.DONE;h.error=b;h.trigger("error");t()}function t(){n.destroy();n=null;h.trigger("loadend")}function v(b){n.bind("Error",function(b,a){w(a)});n.bind("Progress",function(a){h.result=b.exec.call(n,"FileReader","getResult");h.trigger(a)});n.bind("Load",function(a){h.readyState=g.DONE;h.result=b.exec.call(n,"FileReader","getResult");h.trigger(a);t()});b.exec.call(n,"FileReader","read",f,p)}n=new c;this.convertEventPropsToHandlers(k);if(this.readyState===g.LOADING)return w(new a.DOMException(a.DOMException.INVALID_STATE_ERR));
this.readyState=g.LOADING;this.trigger("loadstart");if(p instanceof e)if(p.isDetached()){var z=p.getSource();switch(f){case "readAsText":case "readAsBinaryString":this.result=z;break;case "readAsDataURL":this.result="data:"+p.type+";base64,"+d.btoa(z)}this.readyState=g.DONE;this.trigger("load");t()}else v(n.connectRuntime(p.ruid));else w(new a.DOMException(a.DOMException.NOT_FOUND_ERR))}var h=this,n;f.extend(this,{uid:f.guid("uid_"),readyState:g.EMPTY,result:null,error:null,readAsBinaryString:function(a){b.call(this,
"readAsBinaryString",a)},readAsDataURL:function(a){b.call(this,"readAsDataURL",a)},readAsText:function(a){b.call(this,"readAsText",a)},abort:function(){this.result=null;-1===f.inArray(this.readyState,[g.EMPTY,g.DONE])&&(this.readyState===g.LOADING&&(this.readyState=g.DONE),n&&n.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort();n&&(n.getRuntime().exec.call(this,"FileReader","destroy"),n.disconnectRuntime());h=n=null}})}
var k="loadstart progress load abort error loadend".split(" ");g.EMPTY=0;g.LOADING=1;g.DONE=2;g.prototype=b.instance;return g});q("moxie/core/utils/Url",[],function(){var f=function(d,a){for(var b="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" "),e=b.length,h={http:80,https:443},c={},g=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(d||
"");e--;)g[e]&&(c[b[e]]=g[e]);c.scheme||(a&&"string"!==typeof a||(a=f(a||document.location.href)),c.scheme=a.scheme,c.host=a.host,c.port=a.port,b="",/^[^\/]/.test(c.path)&&(b=a.path,b=/(\/|\/[^\.]+)$/.test(b)?b+"/":b.replace(/\/[^\/]+$/,"/")),c.path=b+(c.path||""));c.port||(c.port=h[c.scheme]||80);c.port=parseInt(c.port,10);c.path||(c.path="/");delete c.source;return c};return{parseUrl:f,resolveUrl:function(d){d=f(d);return d.scheme+"://"+d.host+(d.port!=={http:80,https:443}[d.scheme]?":"+d.port:
"")+d.path+(d.query?d.query:"")},hasSameOrigin:function(d){function a(b){return[b.scheme,b.host,b.port].join("/")}"string"===typeof d&&(d=f(d));return a(f())===a(d)}}});q("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(f,d,a){return function(){function b(b,d){if(d.isDetached()){var c=d.getSource();switch(b){case "readAsBinaryString":return c;case "readAsDataURL":return"data:"+d.type+";base64,"+a.btoa(c);case "readAsText":for(var g=
"",k=0,f=c.length;k<f;k++)g+=String.fromCharCode(c[k]);return g}}else return c=this.connectRuntime(d.ruid).exec.call(this,"FileReaderSync","read",b,d),this.disconnectRuntime(),c}d.call(this);f.extend(this,{uid:f.guid("uid_"),readAsBinaryString:function(a){return b.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){return b.call(this,"readAsDataURL",a)},readAsText:function(a){return b.call(this,"readAsText",a)}})}});q("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic",
"moxie/file/Blob"],function(f,d,a){return function(){var b,e=[];d.extend(this,{append:function(f,c){var g=this,k=d.typeOf(c);c instanceof a?b={name:f,value:c}:"array"===k?(f+="[]",d.each(c,function(b){g.append(f,b)})):"object"===k?d.each(c,function(b,a){g.append(f+"["+a+"]",b)}):"null"===k||"undefined"===k||"number"===k&&isNaN(c)?g.append(f,"false"):e.push({name:f,value:c.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return b&&b.value||null},getBlobName:function(){return b&&
b.name||null},each:function(a){d.each(e,function(b){a(b.value,b.name)});b&&a(b.value,b.name)},destroy:function(){b=null;e=[]}})}});q("moxie/xhr/XMLHttpRequest","moxie/core/utils/Basic moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/core/utils/Url moxie/runtime/Runtime moxie/runtime/RuntimeTarget moxie/file/Blob moxie/file/FileReaderSync moxie/xhr/FormData moxie/core/utils/Env moxie/core/utils/Mime".split(" "),function(f,d,a,b,e,h,c,g,k,p,l,n){function u(){this.uid=f.guid("uid_")}
function m(){function a(b,c){if(B.hasOwnProperty(b)){if(1===arguments.length)return l.can("define_property")?B[b]:O[b];l.can("define_property")?B[b]=c:O[b]=c}}function k(b){function d(){E.destroy();E=null;g.dispatchEvent("loadend");g=null}function e(c){E.bind("LoadStart",function(b){a("readyState",m.LOADING);g.dispatchEvent("readystatechange");g.dispatchEvent(b);L&&g.upload.dispatchEvent(b)});E.bind("Progress",function(b){a("readyState")!==m.LOADING&&(a("readyState",m.LOADING),g.dispatchEvent("readystatechange"));
g.dispatchEvent(b)});E.bind("UploadProgress",function(a){L&&g.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:a.total,loaded:a.loaded})});E.bind("Load",function(b){a("readyState",m.DONE);a("status",Number(c.exec.call(E,"XMLHttpRequest","getStatus")||0));a("statusText",w[a("status")]||"");a("response",c.exec.call(E,"XMLHttpRequest","getResponse",a("responseType")));~f.inArray(a("responseType"),["text",""])?a("responseText",a("response")):"document"===a("responseType")&&a("responseXML",
a("response"));R=c.exec.call(E,"XMLHttpRequest","getAllResponseHeaders");g.dispatchEvent("readystatechange");0<a("status")?(L&&g.upload.dispatchEvent(b),g.dispatchEvent(b)):(S=!0,g.dispatchEvent("error"));d()});E.bind("Abort",function(a){g.dispatchEvent(a);d()});E.bind("Error",function(b){S=!0;a("readyState",m.DONE);g.dispatchEvent("readystatechange");H=!0;g.dispatchEvent(b);d()});c.exec.call(E,"XMLHttpRequest","send",{url:x,method:C,async:q,user:r,password:N,headers:J,mimeType:D,encoding:P,responseType:g.responseType,
withCredentials:g.withCredentials,options:I},b)}var g=this;(new Date).getTime();E=new c;"string"===typeof I.required_caps&&(I.required_caps=h.parseCaps(I.required_caps));I.required_caps=f.extend({},I.required_caps,{return_response_type:g.responseType});b instanceof p&&(I.required_caps.send_multipart=!0);U||(I.required_caps.do_cors=!0);I.ruid?e(E.connectRuntime(I)):(E.bind("RuntimeInit",function(a,b){e(b)}),E.bind("RuntimeError",function(a,b){g.dispatchEvent("RuntimeError",b)}),E.connectRuntime(I))}
var O=this,B={timeout:0,readyState:m.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},q=!0,x,C,J={},r,N,P=null,D=null,K=!1,A=!1,L=!1,H=!1,S=!1,U=!1,I={},E,R="",Q;f.extend(this,B,{uid:f.guid("uid_"),upload:new u,open:function(c,k,g,h,l){if(!c||!k)throw new d.DOMException(d.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(c)||b.utf8_encode(c)!==c)throw new d.DOMException(d.DOMException.SYNTAX_ERR);~f.inArray(c.toUpperCase(),"CONNECT DELETE GET HEAD OPTIONS POST PUT TRACE TRACK".split(" "))&&
(C=c.toUpperCase());if(~f.inArray(C,["CONNECT","TRACE","TRACK"]))throw new d.DOMException(d.DOMException.SECURITY_ERR);k=b.utf8_encode(k);c=e.parseUrl(k);U=e.hasSameOrigin(c);x=e.resolveUrl(k);if((h||l)&&!U)throw new d.DOMException(d.DOMException.INVALID_ACCESS_ERR);r=h||c.user;N=l||c.pass;q=g||!0;if(!1===q&&(a("timeout")||a("withCredentials")||""!==a("responseType")))throw new d.DOMException(d.DOMException.INVALID_ACCESS_ERR);K=!q;A=!1;J={};a("responseText","");a("responseXML",null);a("response",
null);a("status",0);a("statusText","");a("readyState",m.OPENED);this.convertEventPropsToHandlers(["readystatechange"]);this.dispatchEvent("readystatechange")},setRequestHeader:function(c,e){if(a("readyState")!==m.OPENED||A)throw new d.DOMException(d.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(c)||b.utf8_encode(c)!==c)throw new d.DOMException(d.DOMException.SYNTAX_ERR);c=f.trim(c).toLowerCase();if(~f.inArray(c,"accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 content-transfer-encoding date expect host keep-alive origin referer te trailer transfer-encoding upgrade user-agent via".split(" "))||
/^(proxy\-|sec\-)/.test(c))return!1;J[c]=J[c]?J[c]+(", "+e):e;return!0},getAllResponseHeaders:function(){return R||""},getResponseHeader:function(a){a=a.toLowerCase();return S||~f.inArray(a,["set-cookie","set-cookie2"])?null:R&&""!==R&&(Q||(Q={},f.each(R.split(/\r\n/),function(a){a=a.split(/:\s+/);2===a.length&&(a[0]=f.trim(a[0]),Q[a[0].toLowerCase()]={header:a[0],value:f.trim(a[1])})})),Q.hasOwnProperty(a))?Q[a].header+": "+Q[a].value:null},overrideMimeType:function(b){var c;if(~f.inArray(a("readyState"),
[m.LOADING,m.DONE]))throw new d.DOMException(d.DOMException.INVALID_STATE_ERR);b=f.trim(b.toLowerCase());/;/.test(b)&&(c=b.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(b=c[1]);if(!n.mimes[b])throw new d.DOMException(d.DOMException.SYNTAX_ERR);},send:function(a,c){I="string"===f.typeOf(c)?{ruid:c}:c?c:{};this.convertEventPropsToHandlers(t);this.upload.convertEventPropsToHandlers(t);if(this.readyState!==m.OPENED||A)throw new d.DOMException(d.DOMException.INVALID_STATE_ERR);if(a instanceof g)I.ruid=a.ruid,
D=a.type||"application/octet-stream";else if(a instanceof p){if(a.hasBlob()){var e=a.getBlob();I.ruid=e.ruid;D=e.type||"application/octet-stream"}}else"string"===typeof a&&(P="UTF-8",D="text/plain;charset=UTF-8",a=b.utf8_encode(a));this.withCredentials||(this.withCredentials=I.required_caps&&I.required_caps.send_browser_cookies&&!U);L=!K&&this.upload.hasEventListener();S=!1;H=!a;K||(A=!0);k.call(this,a)},abort:function(){S=!0;K=!1;if(~f.inArray(a("readyState"),[m.UNSENT,m.OPENED,m.DONE]))a("readyState",
m.UNSENT);else{a("readyState",m.DONE);A=!1;if(E)E.getRuntime().exec.call(E,"XMLHttpRequest","abort",H);else throw new d.DOMException(d.DOMException.INVALID_STATE_ERR);H=!0}},destroy:function(){E&&("function"===f.typeOf(E.destroy)&&E.destroy(),E=null);this.unbindAll();this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var w={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",
206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",
414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};u.prototype=a.instance;var t="loadstart progress abort error load timeout loadend".split(" ");
m.UNSENT=0;m.OPENED=1;m.HEADERS_RECEIVED=2;m.LOADING=3;m.DONE=4;m.prototype=a.instance;return m});q("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(f,d,a,b){function e(){function b(a,d){var g=this;k=d;g.bind("TransportingProgress",function(a){n=a.loaded;n<l&&-1===f.inArray(g.state,[e.IDLE,e.DONE])&&c.call(g)},999);g.bind("TransportingComplete",function(){n=l;g.state=e.DONE;p=null;g.result=k.exec.call(g,
"Transporter","getAsBlob",a||"")},999);g.state=e.BUSY;g.trigger("TransportingStarted");c.call(g)}function c(){var a;a=l-n;u>a&&(u=a);a=d.btoa(p.substr(n,u));k.exec.call(this,"Transporter","receive",a,l)}var g,k,p,l,n,u;a.call(this);f.extend(this,{uid:f.guid("uid_"),state:e.IDLE,result:null,transport:function(a,c,d){var e=this;d=f.extend({chunk_size:204798},d);if(g=d.chunk_size%3)d.chunk_size+=3-g;u=d.chunk_size;l=n=0;p=this.result=null;p=a;l=a.length;if("string"===f.typeOf(d)||d.ruid)b.call(e,c,this.connectRuntime(d));
else{var k=function(a,d){e.unbind("RuntimeInit",k);b.call(e,c,d)};this.bind("RuntimeInit",k);this.connectRuntime(d)}},abort:function(){this.state=e.IDLE;k&&(k.exec.call(this,"Transporter","clear"),this.trigger("TransportingAborted"));l=n=0;p=this.result=null},destroy:function(){this.unbindAll();k=null;this.disconnectRuntime();l=n=0;p=this.result=null}})}e.IDLE=0;e.BUSY=1;e.DONE=2;e.prototype=b.instance;return e});q("moxie/image/Image","moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/Exceptions moxie/file/FileReaderSync moxie/xhr/XMLHttpRequest moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/runtime/Transporter moxie/core/utils/Env moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/core/utils/Encode".split(" "),
function(f,d,a,b,e,h,c,g,k,p,l,n,u){function m(){function b(c){var d=f.typeOf(c);try{if(c instanceof m){if(!c.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);p.apply(this,arguments)}else if(c instanceof l){if(!~f.inArray(c.type,["image/jpeg","image/png"]))throw new a.ImageError(a.ImageError.WRONG_FORMAT);z.apply(this,arguments)}else if(-1!==f.inArray(d,["blob","file"]))b.call(this,new n(null,c),arguments[1]);else if("string"===d)/^data:[^;]*;base64,/.test(c)?b.call(this,new l(null,
{data:c}),arguments[1]):O.apply(this,arguments);else if("node"===d&&"img"===c.nodeName.toLowerCase())b.call(this,c.src,arguments[1]);else throw new a.DOMException(a.DOMException.TYPE_MISMATCH_ERR);}catch(e){this.trigger("error",e)}}function p(a,b){var c=this.connectRuntime(a.ruid);this.ruid=c.uid;c.exec.call(this,"Image","loadFromImage",a,"undefined"===f.typeOf(b)?!0:b)}function z(a,b){function c(b){d.ruid=b.uid;b.exec.call(d,"Image","loadFromBlob",a)}var d=this;d.name=a.name||"";a.isDetached()?(this.bind("RuntimeInit",
function(a,b){c(b)}),b&&"string"===typeof b.required_caps&&(b.required_caps=h.parseCaps(b.required_caps)),this.connectRuntime(f.extend({required_caps:{access_image_binary:!0,resize_image:!0}},b))):c(this.connectRuntime(a.ruid))}function O(a,b){var c=this,d;d=new e;d.open("get",a);d.responseType="blob";d.onprogress=function(a){c.trigger(a)};d.onload=function(){z.call(c,d.response,!0)};d.onerror=function(a){c.trigger(a)};d.onloadend=function(){d.destroy()};d.bind("RuntimeError",function(a,b){c.trigger("RuntimeError",
b)});d.send(null,b)}c.call(this);f.extend(this,{uid:f.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){var a=void 0,a=this.getRuntime().exec.call(this,"Image","getInfo");this.size=a.size;this.width=a.width;this.height=a.height;this.type=a.type;this.meta=a.meta;""===this.name&&(this.name=a.name)},999);this.convertEventPropsToHandlers(w);b.apply(this,arguments)},downsize:function(b,
c,d,e){try{if(!this.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);if(this.width>m.MAX_RESIZE_WIDTH||this.height>m.MAX_RESIZE_HEIGHT)throw new a.ImageError(a.ImageError.MAX_RESOLUTION_ERR);if(!b&&!c||"undefined"===f.typeOf(d))d=!1;b=b||this.width;c=c||this.height;e="undefined"===f.typeOf(e)?!0:!!e;this.getRuntime().exec.call(this,"Image","downsize",b,c,d,e)}catch(k){this.trigger("error",k)}},crop:function(a,b,c){this.downsize(a,b,!0,c)},getAsCanvas:function(){if(!k.can("create_canvas"))throw new a.RuntimeError(a.RuntimeError.NOT_SUPPORTED_ERR);
return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(b,c){if(!this.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);b||(b="image/jpeg");"image/jpeg"!==b||c||(c=90);return this.getRuntime().exec.call(this,"Image","getAsBlob",b,c)},getAsDataURL:function(b,c){if(!this.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",b,c)},getAsBinaryString:function(a,b){var c=this.getAsDataURL(a,
b);return u.atob(c.substring(c.indexOf("base64,")+7))},embed:function(b,c){function e(){if(k.can("create_canvas")){var c=l.getAsCanvas();if(c){b.appendChild(c);c=null;l.destroy();h.trigger("embedded");return}}c=l.getAsDataURL(p,n);if(!c)throw new a.ImageError(a.ImageError.WRONG_FORMAT);if(k.can("use_data_uri_of",c.length))b.innerHTML='<img src="'+c+'" width="'+l.width+'" height="'+l.height+'" />',l.destroy(),h.trigger("embedded");else{var d=new g;d.bind("TransportingComplete",function(){L=h.connectRuntime(this.result.ruid);
h.bind("Embedded",function(){f.extend(L.getShimContainer().style,{top:"0px",left:"0px",width:l.width+"px",height:l.height+"px"});L=null},999);L.exec.call(h,"ImageView","display",this.result.uid,w,z);l.destroy()});d.transport(u.atob(c.substring(c.indexOf("base64,")+7)),p,f.extend({},v,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:b}))}}var h=this,l,p,n,t,v=c||{},w=this.width,z=this.height,L;try{if(!(b=d.get(b)))throw new a.DOMException(a.DOMException.INVALID_NODE_TYPE_ERR);
if(!this.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);if(this.width>m.MAX_RESIZE_WIDTH||this.height>m.MAX_RESIZE_HEIGHT)throw new a.ImageError(a.ImageError.MAX_RESOLUTION_ERR);p=v.type||this.type||"image/jpeg";n=v.quality||90;t="undefined"!==f.typeOf(v.crop)?v.crop:!1;if(v.width)w=v.width,z=v.height||w;else{var H=d.getSize(b);H.w&&H.h&&(w=H.w,z=H.h)}l=new m;l.bind("Resize",function(){e.call(h)});l.bind("Load",function(){l.downsize(w,z,t,!1)});l.clone(this,!1);return l}catch(O){this.trigger("error",
O)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime());this.unbindAll()}})}var w=["progress","load","error","resize","embedded"];m.MAX_RESIZE_WIDTH=6500;m.MAX_RESIZE_HEIGHT=6500;m.prototype=p.instance;return m});q("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(f,d,a,b){var e={};a.addConstructor("html5",function(d,c,g){var k=this,p=a.capTest,l=a.capTrue;
g=f.extend({access_binary:p(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return k.can("access_binary")&&!!e.Image},display_media:p(b.can("create_canvas")||b.can("use_data_uri_over32kb")),do_cors:p(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:p(function(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&("IE"!==b.browser||9<b.version)}()),filter_by_extension:p("Chrome"===b.browser&&
28<=b.version||"IE"===b.browser&&10<=b.version),return_response_headers:l,return_response_type:function(a){return"json"===a&&window.JSON?!0:b.can("return_response_type",a)},return_status_code:l,report_upload_progress:p(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return k.can("access_binary")&&b.can("create_canvas")},select_file:function(){return b.can("use_fileinput")&&window.File},select_folder:function(){return k.can("select_file")&&"Chrome"===b.browser&&21<=b.version},
select_multiple:function(){return k.can("select_file")&&!("Safari"===b.browser&&"Windows"===b.os)&&!("iOS"===b.os&&b.verComp(b.osVersion,"7.0.4","<"))},send_binary_string:p(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:p(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||k.can("send_binary_string")},slice_blob:p(window.File&&(File.prototype.mozSlice||
File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return k.can("slice_blob")&&k.can("send_multipart")},summon_file_dialog:p("Firefox"===b.browser&&4<=b.version||"Opera"===b.browser&&12<=b.version||"IE"===b.browser&&10<=b.version||!!~f.inArray(b.browser,["Chrome","Safari"])),upload_filesize:l},g);a.call(this,d,c||"html5",g);f.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(k);a=k=null}}(this.destroy)});f.extend(this.getShim(),
e)});return e});q("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(f,d){return f.Blob=function(){function a(a,d,f){var c;if(window.File.prototype.slice)try{return a.slice(),a.slice(d,f)}catch(g){return a.slice(d,f-d)}else return(c=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?c.call(a,d,f):null}this.slice=function(){return new d(this.getRuntime().uid,a.apply(this,arguments))}}});q("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(f){function d(){this.returnValue=
!1}function a(){this.cancelBubble=!0}var b={},e="moxie_"+f.guid(),h=function(a,d,k){var h;d=d.toLowerCase();if(a[e]&&b[a[e]]&&b[a[e]][d]){h=b[a[e]][d];for(var l=h.length-1;0<=l;l--)if(h[l].orig===k||h[l].key===k)if(a.removeEventListener?a.removeEventListener(d,h[l].func,!1):a.detachEvent&&a.detachEvent("on"+d,h[l].func),h[l].orig=null,h[l].func=null,h.splice(l,1),void 0!==k)break;h.length||delete b[a[e]][d];if(f.isEmptyObj(b[a[e]])){delete b[a[e]];try{delete a[e]}catch(n){a[e]=void 0}}}};return{addEvent:function(c,
g,k,h){var l;g=g.toLowerCase();c.addEventListener?(l=k,c.addEventListener(g,l,!1)):c.attachEvent&&(l=function(){var b=window.event;b.target||(b.target=b.srcElement);b.preventDefault=d;b.stopPropagation=a;k(b)},c.attachEvent("on"+g,l));c[e]||(c[e]=f.guid());b.hasOwnProperty(c[e])||(b[c[e]]={});c=b[c[e]];c.hasOwnProperty(g)||(c[g]=[]);c[g].push({func:l,orig:k,key:h})},removeEvent:h,removeAllEvents:function(a,d){a&&a[e]&&f.each(b[a[e]],function(b,e){h(a,e,d)})}}});q("moxie/runtime/html5/file/FileInput",
"moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(f,d,a,b,e,h){return f.FileInput=function(){var c=[],g;d.extend(this,{init:function(k){var f=this,l=f.getRuntime(),n,u,m;g=k;c=[];k=g.accept.mimes||e.extList2mimes(g.accept,l.can("filter_by_extension"));n=l.getShimContainer();n.innerHTML='<input id="'+l.uid+'" type="file" style="font-size:999px;opacity:0;"'+(g.multiple&&l.can("select_multiple")?
"multiple":"")+(g.directory&&l.can("select_folder")?"webkitdirectory directory":"")+(k?' accept="'+k.join(",")+'"':"")+" />";k=a.get(l.uid);d.extend(k.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});u=a.get(g.browse_button);l.can("summon_file_dialog")&&("static"===a.getStyle(u,"position")&&(u.style.position="relative"),m=parseInt(a.getStyle(u,"z-index"),10)||1,u.style.zIndex=m,n.style.zIndex=m-1,b.addEvent(u,"click",function(b){var c=a.get(l.uid);c&&!c.disabled&&c.click();b.preventDefault()},
f.uid));n=l.can("summon_file_dialog")?u:n;b.addEvent(n,"mouseover",function(){f.trigger("mouseenter")},f.uid);b.addEvent(n,"mouseout",function(){f.trigger("mouseleave")},f.uid);b.addEvent(n,"mousedown",function(){f.trigger("mousedown")},f.uid);b.addEvent(a.get(g.container),"mouseup",function(){f.trigger("mouseup")},f.uid);k.onchange=function t(){c=[];g.directory?d.each(this.files,function(a){"."!==a.name&&c.push(a)}):c=[].slice.call(this.files);if("IE"!==h.browser)this.value="";else{var a=this.cloneNode(!0);
this.parentNode.replaceChild(a,this);a.onchange=t}f.trigger("change")};f.trigger({type:"ready",async:!0});n=null},getFiles:function(){return c},disable:function(b){var c=this.getRuntime();if(c=a.get(c.uid))c.disabled=!!b},destroy:function(){var d=this.getRuntime(),e=d.getShim(),d=d.getShimContainer();b.removeAllEvents(d,this.uid);b.removeAllEvents(g&&a.get(g.container),this.uid);b.removeAllEvents(g&&a.get(g.browse_button),this.uid);d&&(d.innerHTML="");e.removeInstance(this.uid);c=g=null}})}});q("moxie/runtime/html5/file/FileDrop",
["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(f,d,a,b,e){return f.FileDrop=function(){function f(a){for(var b=[],c=0;c<a.length;c++)[].push.apply(b,a[c].extensions.split(/\s*,\s*/));return-1===d.inArray("*",b)?b:[]}function c(a){a=e.getFileExtension(a.name);return!a||!u.length||-1!==d.inArray(a,u)}function g(a,b){var e=[];d.each(a,function(a){var b=a.webkitGetAsEntry();b&&(b.isFile?(a=a.getAsFile(),c(a)&&
n.push(a)):e.push(b))});e.length?k(e,b):b()}function k(a,b){var c=[];d.each(a,function(a){c.push(function(b){p(a,b)})});d.inSeries(c,function(){b()})}function p(a,b){a.isFile?a.file(function(a){c(a)&&n.push(a);b()},function(){b()}):a.isDirectory?l(a,b):b()}function l(a,b){function c(a){e.readEntries(function(b){b.length?([].push.apply(d,b),c(a)):a()},a)}var d=[],e=a.createReader();c(function(){k(d,b)})}var n=[],u=[],m;d.extend(this,{init:function(a){var e=this;m=a;u=f(m.accept);a=m.container;b.addEvent(a,
"dragover",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect="copy"},e.uid);b.addEvent(a,"drop",function(a){a.preventDefault();a.stopPropagation();n=[];a.dataTransfer.items&&a.dataTransfer.items[0].webkitGetAsEntry?g(a.dataTransfer.items,function(){e.trigger("drop")}):(d.each(a.dataTransfer.files,function(a){c(a)&&n.push(a)}),e.trigger("drop"))},e.uid);b.addEvent(a,"dragenter",function(a){a.preventDefault();a.stopPropagation();e.trigger("dragenter")},e.uid);b.addEvent(a,
"dragleave",function(a){a.preventDefault();a.stopPropagation();e.trigger("dragleave")},e.uid)},getFiles:function(){return n},destroy:function(){b.removeAllEvents(m&&a.get(m.container),this.uid);n=u=m=null}})}});q("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(f,d,a){return f.FileReader=function(){var b,e=!1;a.extend(this,{read:function(d,c){var g=this;b=new window.FileReader;b.addEventListener("progress",function(a){g.trigger(a)});
b.addEventListener("load",function(a){g.trigger(a)});b.addEventListener("error",function(a){g.trigger(a,b.error)});b.addEventListener("loadend",function(){b=null});"function"===a.typeOf(b[d])?(e=!1,b[d](c.getSource())):"readAsBinaryString"===d&&(e=!0,b.readAsDataURL(c.getSource()))},getResult:function(){var a;b&&b.result?e?(a=b.result,a=d.atob(a.substring(a.indexOf("base64,")+7))):a=b.result:a=null;return a},abort:function(){b&&b.abort()},destroy:function(){b=null}})}});q("moxie/runtime/html5/xhr/XMLHttpRequest",
"moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Url moxie/file/File moxie/file/Blob moxie/xhr/FormData moxie/core/Exceptions moxie/core/utils/Env".split(" "),function(f,d,a,b,e,h,c,g,k){return f.XMLHttpRequest=function(){function f(a,b){var c=this,d,e;d=b.getBlob().getSource();e=new window.FileReader;e.onload=function(){b.append(b.getBlobName(),new h(null,{type:d.type,data:e.result}));u.send.call(c,a,b)};e.readAsBinaryString(d)}function l(){if(!window.XMLHttpRequest||
"IE"===k.browser&&8>k.version){var a;a:{for(var b=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],c=0;c<b.length;c++)try{a=new ActiveXObject(b[c]);break a}catch(d){}a=void 0}return a}return new window.XMLHttpRequest}function n(a){var b="----moxieboundary"+(new Date).getTime(),c="";if(!this.getRuntime().can("send_binary_string"))throw new g.RuntimeError(g.RuntimeError.NOT_SUPPORTED_ERR);m.setRequestHeader("Content-Type","multipart/form-data; boundary="+b);a.each(function(a,d){c=a instanceof h?c+("--"+b+
'\r\nContent-Disposition: form-data; name="'+d+'"; filename="'+unescape(encodeURIComponent(a.name||"blob"))+'"\r\nContent-Type: '+(a.type||"application/octet-stream")+"\r\n\r\n"+a.getSource()+"\r\n"):c+("--"+b+'\r\nContent-Disposition: form-data; name="'+d+'"\r\n\r\n'+unescape(encodeURIComponent(a))+"\r\n")});return c+="--"+b+"--\r\n"}var u=this,m,w;d.extend(this,{send:function(a,e){var g=this,u="Mozilla"===k.browser&&4<=k.version&&7>k.version,q="Android Browser"===k.browser,r=!1;w=a.url.replace(/^.+?\/([\w\-\.]+)$/,
"$1").toLowerCase();m=l();m.open(a.method,a.url,a.async,a.user,a.password);if(e instanceof h)e.isDetached()&&(r=!0),e=e.getSource();else if(e instanceof c){if(e.hasBlob())if(e.getBlob().isDetached())e=n.call(g,e),r=!0;else if((u||q)&&"blob"===d.typeOf(e.getBlob().getSource())&&window.FileReader){f.call(g,a,e);return}if(e instanceof c){var x=new window.FormData;e.each(function(a,b){a instanceof h?x.append(b,a.getSource()):x.append(b,a)});e=x}}m.upload?(a.withCredentials&&(m.withCredentials=!0),m.addEventListener("load",
function(a){g.trigger(a)}),m.addEventListener("error",function(a){g.trigger(a)}),m.addEventListener("progress",function(a){g.trigger(a)}),m.upload.addEventListener("progress",function(a){g.trigger({type:"UploadProgress",loaded:a.loaded,total:a.total})})):m.onreadystatechange=function(){switch(m.readyState){case 3:var c,d;try{b.hasSameOrigin(a.url)&&(c=m.getResponseHeader("Content-Length")||0),m.responseText&&(d=m.responseText.length)}catch(e){c=d=0}g.trigger({type:"progress",lengthComputable:!!c,
total:parseInt(c,10),loaded:d});break;case 4:m.onreadystatechange=function(){},0===m.status?g.trigger("error"):g.trigger("load")}};d.isEmptyObj(a.headers)||d.each(a.headers,function(a,b){m.setRequestHeader(b,a)});""!==a.responseType&&"responseType"in m&&("json"!==a.responseType||k.can("return_response_type","json")?m.responseType=a.responseType:m.responseType="text");r?m.sendAsBinary?m.sendAsBinary(e):function(){for(var a=new Uint8Array(e.length),b=0;b<e.length;b++)a[b]=e.charCodeAt(b)&255;m.send(a.buffer)}():
m.send(e);g.trigger("loadstart")},getStatus:function(){try{if(m)return m.status}catch(a){}return 0},getResponse:function(b){var c=this.getRuntime();try{switch(b){case "blob":var d=new e(c.uid,m.response),g=m.getResponseHeader("Content-Disposition");if(g){var f=g.match(/filename=([\'\"'])([^\1]+)\1/);f&&(w=f[2])}d.name=w;d.type||(d.type=a.getFileMime(w));return d;case "json":return k.can("return_response_type","json")?m.response:200===m.status&&window.JSON?JSON.parse(m.responseText):null;case "document":var l;
var h=m.responseXML,p=m.responseText;"IE"===k.browser&&p&&h&&!h.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(m.getResponseHeader("Content-Type"))&&(h=new window.ActiveXObject("Microsoft.XMLDOM"),h.async=!1,h.validateOnParse=!1,h.loadXML(p));l=h&&("IE"===k.browser&&0!==h.parseError||!h.documentElement||"parsererror"===h.documentElement.tagName)?null:h;return l;default:return""!==m.responseText?m.responseText:null}}catch(n){return null}},getAllResponseHeaders:function(){try{return m.getAllResponseHeaders()}catch(a){}return""},
abort:function(){m&&m.abort()},destroy:function(){u=w=null}})}});q("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){function f(d,f){var c=a?0:-8*(f-1),g=0,k;for(k=0;k<f;k++)g|=b.charCodeAt(d+k)<<Math.abs(c+8*k);return g}function d(a,d,c){c=3===arguments.length?c:b.length-d-1;b=b.substr(0,d)+a+b.substr(c+d)}var a=!1,b;return{II:function(b){if(void 0===b)return a;a=b},init:function(d){a=!1;b=d},SEGMENT:function(a,f,c){switch(arguments.length){case 1:return b.substr(a,b.length-
a-1);case 2:return b.substr(a,f);case 3:d(c,a,f);break;default:return b}},BYTE:function(a){return f(a,1)},SHORT:function(a){return f(a,2)},LONG:function(b,h){if(void 0===h)return f(b,4);var c="",g=a?0:-24,k;for(k=0;4>k;k++)c+=String.fromCharCode(h>>Math.abs(g+8*k)&255);d(c,b,4)},SLONG:function(a){a=f(a,4);return 2147483647<a?a-4294967296:a},STRING:function(a,b){var c="";for(b+=a;a<b;a++)c+=String.fromCharCode(f(a,1));return c}}}});q("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],
function(f){return function a(b){var e=[],h,c,g,k=0;h=new f;h.init(b);if(65496===h.SHORT(0)){for(c=2;c<=b.length;)if(g=h.SHORT(c),65488<=g&&65495>=g)c+=2;else{if(65498===g||65497===g)break;k=h.SHORT(c+2)+2;65505<=g&&65519>=g&&e.push({hex:g,name:"APP"+(g&15),start:c,length:k,segment:h.SEGMENT(c,k)});c+=k}h.init(null);return{headers:e,restore:function(a){var b;h.init(a);c=65504==h.SHORT(2)?4+h.SHORT(4):2;b=0;for(a=e.length;b<a;b++)h.SEGMENT(c,0,e[b].segment),c+=e[b].length;a=h.SEGMENT();h.init(null);
return a},strip:function(b){var c,e;e=new a(b);c=e.headers;e.purge();h.init(b);for(b=c.length;b--;)h.SEGMENT(c[b].start,c[b].length,"");b=h.SEGMENT();h.init(null);return b},get:function(a){for(var b=[],c=0,g=e.length;c<g;c++)e[c].name===a.toUpperCase()&&b.push(e[c].segment);return b},set:function(a,b){var c=[],g,f,k;"string"===typeof b?c.push(b):c=b;g=f=0;for(k=e.length;g<k&&!(e[g].name===a.toUpperCase()&&(e[g].segment=c[f],e[g].length=c[f].length,f++),f>=c.length);g++);},purge:function(){e=[];h.init(null);
h=null}}}}});q("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(f,d){return function(){function a(a,d){var e=b.SHORT(a),f,h,m,w,t,v=[],q={};for(f=0;f<e;f++)if(t=a+12*f+2,m=d[b.SHORT(t)],void 0!==m){h=b.SHORT(t+=2);w=b.LONG(t+=2);t+=4;v=[];switch(h){case 1:case 7:4<w&&(t=b.LONG(t)+c.tiffHeader);for(h=0;h<w;h++)v[h]=b.BYTE(t+h);break;case 2:4<w&&(t=b.LONG(t)+c.tiffHeader);q[m]=b.STRING(t,w-1);continue;case 3:2<w&&(t=b.LONG(t)+c.tiffHeader);
for(h=0;h<w;h++)v[h]=b.SHORT(t+2*h);break;case 4:1<w&&(t=b.LONG(t)+c.tiffHeader);for(h=0;h<w;h++)v[h]=b.LONG(t+4*h);break;case 5:t=b.LONG(t)+c.tiffHeader;for(h=0;h<w;h++)v[h]=b.LONG(t+4*h)/b.LONG(t+4*h+4);break;case 9:t=b.LONG(t)+c.tiffHeader;for(h=0;h<w;h++)v[h]=b.SLONG(t+4*h);break;case 10:t=b.LONG(t)+c.tiffHeader;for(h=0;h<w;h++)v[h]=b.SLONG(t+4*h)/b.SLONG(t+4*h+4);break;default:continue}w=1==w?v[0]:v;g.hasOwnProperty(m)&&"object"!=typeof w?q[m]=g[m][w]:q[m]=w}return q}var b,e,h,c={},g;b=new d;
e={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",
41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};g={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",
14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",
16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},
Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};return{init:function(d){c={tiffHeader:10};if(void 0===d||!d.length)return!1;b.init(d);return 65505===b.SHORT(0)&&"EXIF\x00"===b.STRING(4,5).toUpperCase()?(d=c.tiffHeader,b.II(18761==b.SHORT(d)),42!==b.SHORT(d+=2)?d=!1:(c.IFD0=c.tiffHeader+b.LONG(d+
2),h=a(c.IFD0,e.tiff),"ExifIFDPointer"in h&&(c.exifIFD=c.tiffHeader+h.ExifIFDPointer,delete h.ExifIFDPointer),"GPSInfoIFDPointer"in h&&(c.gpsIFD=c.tiffHeader+h.GPSInfoIFDPointer,delete h.GPSInfoIFDPointer),d=!0),d):!1},TIFF:function(){return h},EXIF:function(){var b;b=a(c.exifIFD,e.exif);if(b.ExifVersion&&"array"===f.typeOf(b.ExifVersion)){for(var d=0,g="";d<b.ExifVersion.length;d++)g+=String.fromCharCode(b.ExifVersion[d]);b.ExifVersion=g}return b},GPS:function(){var b;b=a(c.gpsIFD,e.gps);b.GPSVersionID&&
"array"===f.typeOf(b.GPSVersionID)&&(b.GPSVersionID=b.GPSVersionID.join("."));return b},setExif:function(a,d){if("PixelXDimension"!==a&&"PixelYDimension"!==a)return!1;var g;g=a;var f,h,m,w=0;if("string"===typeof g)for(h in f=e.exif,f)if(f[h]===g){g=h;break}f=c.exifIFD;h=b.SHORT(f);for(var t=0;t<h;t++)if(m=f+12*t+2,b.SHORT(m)==g){w=m+8;break}w?(b.LONG(w,d),g=!0):g=!1;return g},getBinary:function(){return b.SEGMENT()},purge:function(){b.init(null);b=h=null;c={}}}}});q("moxie/runtime/html5/image/JPEG",
["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(f,d,a,b,e){return function(h){var c,g,k,p,l,n;c=h;g=new b;g.init(c);if(65496!==g.SHORT(0))throw new d.ImageError(d.ImageError.WRONG_FORMAT);k=new a(h);p=new e;n=!!p.init(k.get("app1")[0]);l=function(){for(var a=0,b;a<=c.length;){b=g.SHORT(a+=2);if(65472<=b&&65475>=b)return a+=5,{height:g.SHORT(a),width:g.SHORT(a+2)};b=g.SHORT(a+=
2);a+=b-2}return null}.call(this);f.extend(this,{type:"image/jpeg",size:c.length,width:l&&l.width||0,height:l&&l.height||0,setExif:function(a,b){if(!n)return!1;"object"===f.typeOf(a)?f.each(a,function(a,b){p.setExif(b,a)}):p.setExif(a,b);k.set("app1",p.getBinary())},writeHeaders:function(){return arguments.length?k.restore(arguments[0]):c=k.restore(c)},stripHeaders:function(a){return k.strip(a)},purge:function(){p&&k&&g&&(p.purge(),k.purge(),g.init(null),c=l=k=p=g=null)}});n&&(this.meta={tiff:p.TIFF(),
exif:p.EXIF(),gps:p.GPS()})}});q("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(f,d,a){return function(b){function e(){c&&(c.init(null),h=g=c=null)}var h,c,g;h=b;c=new a;c.init(h);(function(){for(var a=0,b=0,d=[35152,20039,3338,6666],b=0;b<d.length;b++,a+=2)if(d[b]!=c.SHORT(a))throw new f.ImageError(f.ImageError.WRONG_FORMAT);})();g=function(){var a=8,b,d,e;b=c.LONG(a);d=c.STRING(a+=4,4);e=a+=4;c.LONG(a+b);return"IHDR"==
d?{width:c.LONG(e),height:c.LONG(e+4)}:null}.call(this);d.extend(this,{type:"image/png",size:h.length,width:g.width,height:g.height,purge:function(){e.call(this)}});e.call(this)}});q("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(f,d,a,b){return function(e){var h=[a,b],c;c=function(){for(var a=0;a<h.length;a++)try{return new h[a](e)}catch(b){}throw new d.ImageError(d.ImageError.WRONG_FORMAT);
}();f.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(a){return a},stripHeaders:function(a){return a},purge:function(){}});f.extend(this,c);this.purge=function(){c.purge();c=null}}});q("moxie/runtime/html5/image/MegaPixel",[],function(){function f(d){var a=d.naturalWidth;if(1048576<a*d.naturalHeight){var b=document.createElement("canvas");b.width=b.height=1;b=b.getContext("2d");b.drawImage(d,-a+1,0);return 0===b.getImageData(0,0,1,1).data[3]}return!1}return{isSubsampled:f,
renderTo:function(d,a,b){var e=d.naturalWidth,h=d.naturalHeight,c=b.width,g=b.height,k=b.x||0;b=b.y||0;a=a.getContext("2d");f(d)&&(e/=2,h/=2);var p=document.createElement("canvas");p.width=p.height=1024;var l=p.getContext("2d"),n;n=h;var u=document.createElement("canvas");u.width=1;u.height=n;u=u.getContext("2d");u.drawImage(d,0,0);for(var u=u.getImageData(0,0,1,n).data,m=0,w=n,t=n;t>m;)0===u[4*(t-1)+3]?w=t:m=t,t=w+m>>1;n=t/n;n=0===n?1:n;for(u=0;u<h;){m=u+1024>h?h-u:1024;for(w=0;w<e;)t=w+1024>e?e-
w:1024,l.clearRect(0,0,1024,1024),l.drawImage(d,-w,-u),a.drawImage(p,0,0,t,m,w*c/e+k<<0,u*g/h/n+b<<0,Math.ceil(t*c/e),Math.ceil(m*g/h/n)),w+=1024;u+=1024}}}});q("moxie/runtime/html5/image/Image","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/Exceptions moxie/core/utils/Encode moxie/file/File moxie/runtime/html5/image/ImageInfo moxie/runtime/html5/image/MegaPixel moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(f,d,a,b,e,h,c,g,k){return f.Image=function(){function f(){if(!r&&
!v)throw new a.ImageError(a.DOMException.INVALID_STATE_ERR);return r||v}function l(a){return b.atob(a.substring(a.indexOf("base64,")+7))}function n(c){var d=this;v=new Image;v.onerror=function(){w.call(this);d.trigger("error",new a.ImageError(a.ImageError.WRONG_FORMAT))};v.onload=function(){d.trigger("load")};v.src=/^data:[^;]*;base64,/.test(c)?c:"data:"+(y.type||"")+";base64,"+b.btoa(c)}function u(b,c){var d=this,e;if(window.FileReader)e=new FileReader,e.onload=function(){c(this.result)},e.onerror=
function(){d.trigger("error",new a.FileException(a.FileException.NOT_READABLE_ERR))},e.readAsDataURL(b);else return c(b.getAsDataURL())}function m(a,b,e,g){var h,l=0,n=0,m,H;C=g;H=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;-1!==d.inArray(H,[5,6,7,8])&&(m=a,a=b,b=m);m=f();h=(e?Math.max:Math.min)(a/m.width,b/m.height);if(!(1<h)||e&&!g){r||(r=document.createElement("canvas"));g=Math.round(m.width*h);h=Math.round(m.height*h);e?(r.width=a,r.height=b,g>a&&(l=Math.round((g-a)/2)),h>b&&(n=Math.round((h-
b)/2))):(r.width=g,r.height=h);if(!C){a=r.width;b=r.height;switch(H){case 5:case 6:case 7:case 8:r.width=b;r.height=a;break;default:r.width=a,r.height=b}e=r.getContext("2d");switch(H){case 2:e.translate(a,0);e.scale(-1,1);break;case 3:e.translate(a,b);e.rotate(Math.PI);break;case 4:e.translate(0,b);e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI);e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI);e.translate(0,-b);break;case 7:e.rotate(.5*Math.PI);e.translate(a,-b);e.scale(-1,1);break;case 8:e.rotate(-.5*
Math.PI),e.translate(-a,0)}}H=r;l=-l;n=-n;"iOS"===k.OS?c.renderTo(m,H,{width:g,height:h,x:l,y:n}):H.getContext("2d").drawImage(m,l,n,g,h);this.width=r.width;this.height=r.height;x=!0}this.trigger("Resize")}function w(){q&&(q.purge(),q=null);B=v=r=y=null;x=!1}var t=this,v,q,r,B,y,x=!1,C=!0;d.extend(this,{loadFromBlob:function(b){var c=this,d=c.getRuntime(),e=1<arguments.length?arguments[1]:!0;if(!d.can("access_binary"))throw new a.RuntimeError(a.RuntimeError.NOT_SUPPORTED_ERR);y=b;b.isDetached()?(B=
b.getSource(),n.call(this,B)):u.call(this,b.getSource(),function(a){e&&(B=l(a));n.call(c,a)})},loadFromImage:function(a,b){this.meta=a.meta;y=new e(null,{name:a.name,size:a.size,type:a.type});n.call(this,b?B=a.getAsBinaryString():a.getAsDataURL())},getInfo:function(){var a=this.getRuntime();!q&&B&&a.can("access_image_binary")&&(q=new h(B));return{width:f().width||0,height:f().height||0,type:y.type||g.getFileMime(y.name),size:B&&B.length||y.size||0,name:y.name||"",meta:q&&q.meta||this.meta||{}}},downsize:function(){m.apply(this,
arguments)},getAsCanvas:function(){r&&(r.id=this.uid+"_canvas");return r},getAsBlob:function(a,b){a!==this.type&&m.call(this,this.width,this.height,!1);return new e(null,{name:y.name||"",type:a,data:t.getAsBinaryString.call(this,a,b)})},getAsDataURL:function(a,b){var c=b||90;if(!x)return v.src;if("image/jpeg"!==a)return r.toDataURL("image/png");try{return r.toDataURL("image/jpeg",c/100)}catch(d){return r.toDataURL("image/jpeg")}},getAsBinaryString:function(a,b){if(!x)return B||(B=l(t.getAsDataURL(a,
b))),B;if("image/jpeg"!==a)B=l(t.getAsDataURL(a,b));else{var c;b||(b=90);try{c=r.toDataURL("image/jpeg",b/100)}catch(d){c=r.toDataURL("image/jpeg")}B=l(c);q&&(B=q.stripHeaders(B),C&&(q.meta&&q.meta.exif&&q.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),B=q.writeHeaders(B)),q.purge(),q=null)}x=!1;return B},destroy:function(){t=null;w.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}});q("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env",
"moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(f,d,a,b,e){function h(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(c){a="0.0"}}a=a.match(/\d+/g);return parseFloat(a[0]+"."+a[1])}var c={};e.addConstructor("flash",function(g){var k=this,p;g=f.extend({swf_url:d.swf_url},g);e.call(this,g,"flash",{access_binary:function(a){return a&&"browser"===k.mode},
access_image_binary:function(a){return a&&"browser"===k.mode},display_media:e.capTrue,do_cors:e.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===k.mode},resize_image:e.capTrue,return_response_headers:!1,return_response_type:function(a){return"json"===a&&window.JSON?!0:!f.arrayDiff(a,["","text","document"])||"browser"===k.mode},return_status_code:function(a){return"browser"===k.mode||!f.arrayDiff(a,[200,404])},select_file:e.capTrue,select_multiple:e.capTrue,send_binary_string:function(a){return a&&
"browser"===k.mode},send_browser_cookies:function(a){return a&&"browser"===k.mode},send_custom_headers:function(a){return a&&"browser"===k.mode},send_multipart:e.capTrue,slice_blob:e.capTrue,stream_upload:function(a){return a&&"browser"===k.mode},summon_file_dialog:!1,upload_filesize:function(a){return 2097152>=f.parseSizeStr(a)||"client"===k.mode},use_http_method:function(a){return!f.arrayDiff(a,["GET","POST"])}},{access_binary:function(a){return a?"browser":"client"},access_image_binary:function(a){return a?
"browser":"client"},report_upload_progress:function(a){return a?"browser":"client"},return_response_type:function(a){return f.arrayDiff(a,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(a){return f.arrayDiff(a,[200,404])?"browser":["client","browser"]},send_binary_string:function(a){return a?"browser":"client"},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"browser":"client"},stream_upload:function(a){return a?
"client":"browser"},upload_filesize:function(a){return 2097152<=f.parseSizeStr(a)?"client":"browser"}},"client");10>h()&&(this.mode=!1);f.extend(this,{getShim:function(){return a.get(this.uid)},shimExec:function(a,b){var c=[].slice.call(arguments,2);return k.getShim().exec(this.uid,a,b,c)},init:function(){var a,c,e;e=this.getShimContainer();f.extend(e.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});a='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+
g.swf_url+'" ';"IE"===d.browser&&(a+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');a+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+g.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+d.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';"IE"===d.browser?(c=document.createElement("div"),e.appendChild(c),c.outerHTML=a,c=e=null):e.innerHTML=a;p=setTimeout(function(){k&&
!k.initialized&&k.trigger("Error",new b.RuntimeError(b.RuntimeError.NOT_INIT_ERR))},5E3)},destroy:function(a){return function(){a.call(k);clearTimeout(p);g=p=a=k=null}}(this.destroy)},c)});return c});q("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(f,d){return f.Blob={slice:function(a,b,e,f){var c=this.getRuntime();0>b?b=Math.max(a.size+b,0):0<b&&(b=Math.min(b,a.size));0>e?e=Math.max(a.size+e,0):0<e&&(e=Math.min(e,a.size));(a=c.shimExec.call(this,"Blob",
"slice",b,e,f||""))&&(a=new d(c.uid,a));return a}}});q("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(f){return f.FileInput={init:function(d){this.getRuntime().shimExec.call(this,"FileInput","init",{name:d.name,accept:d.accept,multiple:d.multiple});this.trigger("ready")}}});q("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(f,d){function a(a,b){switch(b){case "readAsText":return d.atob(a,"utf8");case "readAsBinaryString":return d.atob(a);
case "readAsDataURL":return a}return null}var b="";return f.FileReader={read:function(d,f){var c=this.getRuntime();"readAsDataURL"===d&&(b="data:"+(f.type||"")+";base64,");this.bind("Progress",function(c,f){f&&(b+=a(f,d))});return c.shimExec.call(this,"FileReader","readAsBase64",f.uid)},getResult:function(){return b},destroy:function(){b=null}}});q("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(f,d){function a(a,e){switch(e){case "readAsText":return d.atob(a,
"utf8");case "readAsBinaryString":return d.atob(a);case "readAsDataURL":return a}return null}return f.FileReaderSync={read:function(b,d){var f;f=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",d.uid);if(!f)return null;"readAsDataURL"===b&&(f="data:"+(d.type||"")+";base64,"+f);return a(f,b,d.type)}}});q("moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/flash/Runtime moxie/core/utils/Basic moxie/file/Blob moxie/file/File moxie/file/FileReaderSync moxie/xhr/FormData moxie/runtime/Transporter".split(" "),
function(f,d,a,b,e,h,c){return f.XMLHttpRequest={send:function(b,e){function f(){b.transport=m.mode;m.shimExec.call(u,"XMLHttpRequest","send",b,e)}function l(a,b){m.shimExec.call(u,"XMLHttpRequest","appendBlob",a,b.uid);e=null;f()}function n(a,b){var d=new c;d.bind("TransportingComplete",function(){b(this.result)});d.transport(a.getSource(),a.type,{ruid:m.uid})}var u=this,m=u.getRuntime();d.isEmptyObj(b.headers)||d.each(b.headers,function(a,b){m.shimExec.call(u,"XMLHttpRequest","setRequestHeader",
b,a.toString())});if(e instanceof h){var r;e.each(function(b,c){b instanceof a?r=c:m.shimExec.call(u,"XMLHttpRequest","append",c,b)});if(e.hasBlob()){var t=e.getBlob();t.isDetached()?n(t,function(a){t.destroy();l(r,a)}):l(r,t)}else e=null,f()}else e instanceof a?e.isDetached()?n(e,function(a){e.destroy();e=a.uid;f()}):(e=e.uid,f()):f()},getResponse:function(a){var c,f,h=this.getRuntime();if(f=h.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){f=new b(h.uid,f);if("blob"===a)return f;try{c=
new e;if(~d.inArray(a,["","text"]))return c.readAsText(f);if("json"===a&&window.JSON)return JSON.parse(c.readAsText(f))}finally{f.destroy()}}return null},abort:function(a){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}}});q("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(f,d){return f.Transporter={getAsBlob:function(a){var b=this.getRuntime();return(a=b.shimExec.call(this,
"Transporter","getAsBlob",a))?new d(b.uid,a):null}}});q("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(f,d,a,b,e){return f.Image={loadFromBlob:function(b){function c(a){e.shimExec.call(d,"Image","loadFromBlob",a.uid);d=e=null}var d=this,e=d.getRuntime();if(b.isDetached()){var f=new a;f.bind("TransportingComplete",function(){c(f.result.getSource())});f.transport(b.getSource(),
b.type,{ruid:e.uid})}else c(b.getSource())},loadFromImage:function(a){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",a.uid)},getAsBlob:function(a,c){var d=this.getRuntime(),e=d.shimExec.call(this,"Image","getAsBlob",a,c);return e?new b(d.uid,e):null},getAsDataURL:function(){var a=this.getRuntime().Image.getAsBlob.apply(this,arguments);return a?(new e).readAsDataURL(a):null}}});q("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom",
"moxie/core/Exceptions","moxie/runtime/Runtime"],function(f,d,a,b,e){function h(a){var b=!1,c=null,d,e,f,h,r,t=0;try{try{c=new ActiveXObject("AgControl.AgControl"),c.IsVersionSupported(a)&&(b=!0)}catch(q){var v=navigator.plugins["Silverlight Plug-In"];if(v){d=v.description;"1.0.30226.2"===d&&(d="2.0.30226.2");for(e=d.split(".");3<e.length;)e.pop();for(;4>e.length;)e.push(0);for(f=a.split(".");4<f.length;)f.pop();do h=parseInt(f[t],10),r=parseInt(e[t],10),t++;while(t<f.length&&h===r);h<=r&&!isNaN(h)&&
(b=!0)}}}catch(q){b=!1}return b}var c={};e.addConstructor("silverlight",function(g){var k=this,p;g=f.extend({xap_url:d.xap_url},g);e.call(this,g,"silverlight",{access_binary:e.capTrue,access_image_binary:e.capTrue,display_media:e.capTrue,do_cors:e.capTrue,drag_and_drop:!1,report_upload_progress:e.capTrue,resize_image:e.capTrue,return_response_headers:function(a){return a&&"client"===k.mode},return_response_type:function(a){return"json"!==a?!0:!!window.JSON},return_status_code:function(a){return"client"===
k.mode||!f.arrayDiff(a,[200,404])},select_file:e.capTrue,select_multiple:e.capTrue,send_binary_string:e.capTrue,send_browser_cookies:function(a){return a&&"browser"===k.mode},send_custom_headers:function(a){return a&&"client"===k.mode},send_multipart:e.capTrue,slice_blob:e.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:e.capTrue,use_http_method:function(a){return"client"===k.mode||!f.arrayDiff(a,["GET","POST"])}},{return_response_headers:function(a){return a?"client":"browser"},return_status_code:function(a){return f.arrayDiff(a,
[200,404])?"client":["client","browser"]},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"client":"browser"},use_http_method:function(a){return f.arrayDiff(a,["GET","POST"])?"client":["client","browser"]}});h("2.0.31005.0")&&"Opera"!==d.browser||(this.mode=!1);f.extend(this,{getShim:function(){return a.get(this.uid).content.Moxie},shimExec:function(a,b){var c=[].slice.call(arguments,2);return k.getShim().exec(this.uid,a,b,c)},init:function(){this.getShimContainer().innerHTML=
'<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+g.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+d.global_event_dispatcher+'"/></object>';p=setTimeout(function(){k&&!k.initialized&&k.trigger("Error",new b.RuntimeError(b.RuntimeError.NOT_INIT_ERR))},
"Windows"!==d.OS?1E4:5E3)},destroy:function(a){return function(){a.call(k);clearTimeout(p);g=p=a=k=null}}(this.destroy)},c)});return c});q("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(f,d,a){return f.Blob=d.extend({},a)});q("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(f){return f.FileInput={init:function(d){this.getRuntime().shimExec.call(this,"FileInput","init",
function(a){for(var b="",d=0;d<a.length;d++)b+=(""!==b?"|":"")+a[d].title+" | *."+a[d].extensions.replace(/,/g,";*.");return b}(d.accept),d.name,d.multiple);this.trigger("ready")}}});q("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(f,d,a){return f.FileDrop={init:function(){var b=this.getRuntime(),e;e=b.getShimContainer();a.addEvent(e,"dragover",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect=
"copy"},this.uid);a.addEvent(e,"dragenter",function(a){a.preventDefault();d.get(b.uid).dragEnter(a)&&a.stopPropagation()},this.uid);a.addEvent(e,"drop",function(a){a.preventDefault();d.get(b.uid).dragDrop(a)&&a.stopPropagation()},this.uid);return b.shimExec.call(this,"FileDrop","init")}}});q("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(f,d,a){return f.FileReader=d.extend({},a)});q("moxie/runtime/silverlight/file/FileReaderSync",
["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(f,d,a){return f.FileReaderSync=d.extend({},a)});q("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(f,d,a){return f.XMLHttpRequest=d.extend({},a)});q("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],
function(f,d,a){return f.Transporter=d.extend({},a)});q("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(f,d,a){return f.Image=d.extend({},a,{getInfo:function(){var a=["tiff","exif","gps"],e={meta:{}},f=this.getRuntime().shimExec.call(this,"Image","getInfo");f.meta&&d.each(a,function(a){var b=f.meta[a],d,p,l,n;if(b&&b.keys)for(e.meta[a]={},p=0,l=b.keys.length;p<l;p++)if(d=b.keys[p],n=b[d])/^(\d|[1-9]\d+)$/.test(n)?
n=parseInt(n,10):/^\d*\.\d+$/.test(n)&&(n=parseFloat(n)),e.meta[a][d]=n});e.width=parseInt(f.width,10);e.height=parseInt(f.height,10);e.size=parseInt(f.size,10);e.type=f.type;e.name=f.name;return e}})});q("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(f,d,a,b){var e={};a.addConstructor("html4",function(d){var c=this,g=a.capTest,k=a.capTrue;a.call(this,d,"html4",{access_binary:g(window.FileReader||window.File&&
File.getAsDataURL),access_image_binary:!1,display_media:g(e.Image&&(b.can("create_canvas")||b.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:g("Chrome"===b.browser&&28<=b.version||"IE"===b.browser&&10<=b.version),resize_image:function(){return e.Image&&c.can("access_binary")&&b.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(a){return"json"===a&&window.JSON?!0:!!~f.inArray(a,["text","document",""])},return_status_code:function(a){return!f.arrayDiff(a,
[200,404])},select_file:function(){return b.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return c.can("select_file")},summon_file_dialog:g("Firefox"===b.browser&&4<=b.version||"Opera"===b.browser&&12<=b.version||!!~f.inArray(b.browser,["Chrome","Safari"])),upload_filesize:k,use_http_method:function(a){return!f.arrayDiff(a,["GET","POST"])}});f.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(c);
a=c=null}}(this.destroy)});f.extend(this.getShim(),e)});return e});q("moxie/runtime/html4/file/FileInput","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(f,d,a,b,e,h){return f.FileInput=function(){function c(){var e=this,r=e.getRuntime(),m,q,t,v,z;z=d.guid("uid_");m=r.getShimContainer();f&&(q=a.get(f+"_form"))&&d.extend(q.style,{top:"100%"});t=document.createElement("form");t.setAttribute("id",
z+"_form");t.setAttribute("method","post");t.setAttribute("enctype","multipart/form-data");t.setAttribute("encoding","multipart/form-data");d.extend(t.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});v=document.createElement("input");v.setAttribute("id",z);v.setAttribute("type","file");v.setAttribute("name",l.name||"Filedata");v.setAttribute("accept",p.join(","));d.extend(v.style,{fontSize:"999px",opacity:0});t.appendChild(v);m.appendChild(t);d.extend(v.style,
{position:"absolute",top:0,left:0,width:"100%",height:"100%"});"IE"===h.browser&&10>h.version&&d.extend(v.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});v.onchange=function(){var b;this.value&&(b=this.files?this.files[0]:{name:this.value},k=[b],this.onchange=function(){},c.call(e),e.bind("change",function T(){var b=a.get(z),c=a.get(z+"_form"),d;e.unbind("change",T);e.files.length&&b&&c&&(d=e.files[0],b.setAttribute("id",d.uid),c.setAttribute("id",d.uid+"_form"),c.setAttribute("target",
d.uid+"_iframe"))},998),v=t=null,e.trigger("change"))};r.can("summon_file_dialog")&&(r=a.get(l.browse_button),b.removeEvent(r,"click",e.uid),b.addEvent(r,"click",function(a){v&&!v.disabled&&v.click();a.preventDefault()},e.uid));f=z;m=q=r=null}var f,k=[],p=[],l;d.extend(this,{init:function(d){var f=this,g=f.getRuntime(),h;l=d;p=d.accept.mimes||e.extList2mimes(d.accept,g.can("filter_by_extension"));h=g.getShimContainer();(function(){var c,e;c=a.get(d.browse_button);g.can("summon_file_dialog")&&("static"===
a.getStyle(c,"position")&&(c.style.position="relative"),e=parseInt(a.getStyle(c,"z-index"),10)||1,c.style.zIndex=e,h.style.zIndex=e-1);c=g.can("summon_file_dialog")?c:h;b.addEvent(c,"mouseover",function(){f.trigger("mouseenter")},f.uid);b.addEvent(c,"mouseout",function(){f.trigger("mouseleave")},f.uid);b.addEvent(c,"mousedown",function(){f.trigger("mousedown")},f.uid);b.addEvent(a.get(d.container),"mouseup",function(){f.trigger("mouseup")},f.uid);c=null})();c.call(this);h=null;f.trigger({type:"ready",
async:!0})},getFiles:function(){return k},disable:function(b){var c;if(c=a.get(f))c.disabled=!!b},destroy:function(){var c=this.getRuntime(),d=c.getShim(),c=c.getShimContainer();b.removeAllEvents(c,this.uid);b.removeAllEvents(l&&a.get(l.container),this.uid);b.removeAllEvents(l&&a.get(l.browse_button),this.uid);c&&(c.innerHTML="");d.removeInstance(this.uid);f=k=p=l=null}})}});q("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(f,d){return f.FileReader=
d});q("moxie/runtime/html4/xhr/XMLHttpRequest","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Url moxie/core/Exceptions moxie/core/utils/Events moxie/file/Blob moxie/xhr/FormData".split(" "),function(f,d,a,b,e,h,c,g){return f.XMLHttpRequest=function(){function f(b){var c=this,d,e,g,k=!1;if(n){d=n.id.replace(/_iframe$/,"");if(d=a.get(d+"_form")){e=d.getElementsByTagName("input");for(g=e.length;g--;)switch(e[g].getAttribute("type")){case "hidden":e[g].parentNode.removeChild(e[g]);
break;case "file":k=!0}e=[];k||d.parentNode.removeChild(d);d=null}setTimeout(function(){h.removeEvent(n,"load",c.uid);n.parentNode&&n.parentNode.removeChild(n);var a=c.getRuntime().getShimContainer();a.children.length||a.parentNode.removeChild(a);n=null;b()},1)}}var p,l,n;d.extend(this,{send:function(r,m){var q=this,t=q.getRuntime(),v,z,y,B;p=l=null;if(m instanceof g&&m.hasBlob()){if(B=m.getBlob(),v=B.uid,y=a.get(v),z=a.get(v+"_form"),!z)throw new e.DOMException(e.DOMException.NOT_FOUND_ERR);}else v=
d.guid("uid_"),z=document.createElement("form"),z.setAttribute("id",v+"_form"),z.setAttribute("method",r.method),z.setAttribute("enctype","multipart/form-data"),z.setAttribute("encoding","multipart/form-data"),z.setAttribute("target",v+"_iframe"),t.getShimContainer().appendChild(z);m instanceof g&&m.each(function(a,b){if(a instanceof c)y&&y.setAttribute("name",b);else{var e=document.createElement("input");d.extend(e,{type:"hidden",name:b,value:a});y?z.insertBefore(e,y):z.appendChild(e)}});z.setAttribute("action",
r.url);(function(){var a=t.getShimContainer()||document.body,c=document.createElement("div");c.innerHTML='<iframe id="'+v+'_iframe" name="'+v+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';n=c.firstChild;a.appendChild(n);h.addEvent(n,"load",function(){var a;try{a=n.contentWindow.document||n.contentDocument||window.frames[n.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(a.title)?p=a.title.replace(/^(\d+).*$/,"$1"):(p=200,l=d.trim(a.body.innerHTML),q.trigger({type:"progress",
loaded:l.length,total:l.length}),B&&q.trigger({type:"uploadprogress",loaded:B.size||1025,total:B.size||1025}))}catch(c){if(b.hasSameOrigin(r.url))p=404;else{f.call(q,function(){q.trigger("error")});return}}f.call(q,function(){q.trigger("load")})},q.uid)})();z.submit();q.trigger("loadstart")},getStatus:function(){return p},getResponse:function(a){if("json"===a&&"string"===d.typeOf(l)&&window.JSON)try{return JSON.parse(l.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(b){return null}return l},
abort:function(){var a=this;n&&n.contentWindow&&(n.contentWindow.stop?n.contentWindow.stop():n.contentWindow.document.execCommand?n.contentWindow.document.execCommand("Stop"):n.src="about:blank");f.call(this,function(){a.dispatchEvent("abort")})}})}});q("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(f,d){return f.Image=d});(function(f){for(var d=0;d<f.length;d++){for(var a=F,b=f[d],e=b.split(/[.\/]/),h=0;h<e.length-1;++h)void 0===a[e[h]]&&
(a[e[h]]={}),a=a[e[h]];a[e[e.length-1]]=y[b]}})("moxie/core/utils/Basic moxie/core/I18n moxie/core/utils/Mime moxie/core/utils/Env moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/file/Blob moxie/file/File moxie/file/FileInput moxie/file/FileDrop moxie/runtime/RuntimeTarget moxie/file/FileReader moxie/core/utils/Url moxie/file/FileReaderSync moxie/xhr/FormData moxie/xhr/XMLHttpRequest moxie/runtime/Transporter moxie/image/Image moxie/core/utils/Events".split(" "))})(this);
(function(){var F={},r=moxie.core.utils.Basic.inArray;(function q(y){var f,d;for(f in y)d=typeof y[f],"object"!==d||~r(f,["Exceptions","Env","Mime"])?"function"===d&&(F[f]=y[f]):q(y[f])})(window.moxie);F.Env=window.moxie.core.utils.Env;F.Mime=window.moxie.core.utils.Mime;F.Exceptions=window.moxie.core.Exceptions;window.mOxie=F;window.o||(window.o=F);return F})();
(function(F,r,G){function q(a){function b(a,b,d){var e={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};e[a]?f[e[a]]=b:d||(f[a]=b)}var e=a.required_features,f={};"string"===typeof e?d.each(e.split(/\s*,\s*/),function(a){b(a,!0)}):"object"===typeof e?d.each(e,
function(a,d){b(d,a)}):!0===e&&(a.multipart||(f.send_binary_string=!0),0<a.chunk_size&&(f.slice_blob=!0),a.resize.enabled&&(f.send_binary_string=!0),d.each(a,function(a,d){b(d,!!a,!0)}));return f}var y=F.setTimeout,f={},d={VERSION:"2.1.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,
IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:r.mimes,ua:r.ua,typeOf:r.typeOf,extend:r.extend,guid:r.guid,get:function(a){var b=[],d;"array"!==r.typeOf(a)&&(a=[a]);for(var f=a.length;f--;)(d=r.get(a[f]))&&b.push(d);return b.length?b:null},each:r.each,getPos:r.getPos,getSize:r.getSize,xmlEncode:function(a){var b={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},d=/[<>&\"\']/g;return a?(""+a).replace(d,function(a){return b[a]?"&"+b[a]+";":a}):a},toArray:r.toArray,inArray:r.inArray,addI18n:r.addI18n,translate:r.translate,
isEmptyObj:r.isEmptyObj,hasClass:r.hasClass,addClass:r.addClass,removeClass:r.removeClass,getStyle:r.getStyle,addEvent:r.addEvent,removeEvent:r.removeEvent,removeAllEvents:r.removeAllEvents,cleanName:function(a){var b,d;d=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(b=0;b<d.length;b+=2)a=a.replace(d[b],
d[b+1]);a=a.replace(/\s+/g,"_");return a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(a,b){var e="";d.each(b,function(a,b){e+=(e?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)});e&&(a+=(0<a.indexOf("?")?"&":"?")+e);return a},formatSize:function(a){function b(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}if(a===G||/\D/.test(a))return d.translate("N/A");var e=Math.pow(1024,4);return a>e?b(a/e,1)+" "+d.translate("tb"):a>(e/=1024)?b(a/e,1)+" "+d.translate("gb"):a>(e/=1024)?
b(a/e,1)+" "+d.translate("mb"):1024<a?Math.round(a/1024)+" "+d.translate("kb"):a+" "+d.translate("b")},parseSize:r.parseSizeStr,predictRuntime:function(a,b){var e,f;e=new d.Uploader(a);f=r.Runtime.thatCan(e.getOption().required_features,b||a.runtimes);e.destroy();return f},addFileFilter:function(a,b){f[a]=b}};d.addFileFilter("mime_types",function(a,b,e){a.length&&!a.regexp.test(b.name)?(this.trigger("Error",{code:d.FILE_EXTENSION_ERROR,message:d.translate("File extension error."),file:b}),e(!1)):
e(!0)});d.addFileFilter("max_file_size",function(a,b,e){a=d.parseSize(a);void 0!==b.size&&a&&b.size>a?(this.trigger("Error",{code:d.FILE_SIZE_ERROR,message:d.translate("File size error."),file:b}),e(!1)):e(!0)});d.addFileFilter("prevent_duplicates",function(a,b,e){if(a)for(a=this.files.length;a--;)if(b.name===this.files[a].name&&b.size===this.files[a].size){this.trigger("Error",{code:d.FILE_DUPLICATE_ERROR,message:d.translate("Duplicate file error."),file:b});e(!1);return}e(!0)});d.Uploader=function(a){function b(){var a,
b=0,c;if(this.state==d.STARTED){for(c=0;c<C.length;c++)a||C[c].status!=d.QUEUED?b++:(a=C[c],this.trigger("BeforeUpload",a)&&(a.status=d.UPLOADING,this.trigger("UploadFile",a)));b==C.length&&(this.state!==d.STOPPED&&(this.state=d.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",C))}}function e(a){a.percent=0<a.size?Math.ceil(a.loaded/a.size*100):100;h()}function h(){var a,b;D.reset();for(a=0;a<C.length;a++)b=C[a],b.size!==G?(D.size+=b.origSize,D.loaded+=b.loaded*b.origSize/b.size):
D.size=G,b.status==d.DONE?D.uploaded++:b.status==d.FAILED?D.failed++:D.queued++;D.size===G?D.percent=0<C.length?Math.ceil(D.uploaded/C.length*100):0:(D.bytesPerSec=Math.ceil(D.loaded/((+new Date-P||1)/1E3)),D.percent=0<D.size?Math.ceil(D.loaded/D.size*100):0)}function c(){var a=M[0]||N[0];return a?a.getRuntime().uid:!1}function g(a,b){if(a.ruid){var d=r.Runtime.getInfo(a.ruid);if(d)return d.can(b)}return!1}function k(a,b){var c=this,e=0,f=[],g={accept:a.filters.mime_types,runtime_order:a.runtimes,
required_caps:a.required_features,preferred_caps:J,swf_url:a.flash_swf_url,xap_url:a.silverlight_xap_url};d.each(a.runtimes.split(/\s*,\s*/),function(b){a[b]&&(g[b]=a[b])});a.browse_button&&d.each(a.browse_button,function(b){f.push(function(f){var h=new r.FileInput(d.extend({},g,{name:a.file_data_name,multiple:a.multi_selection,container:a.container,browse_button:b}));h.onready=function(){var a=r.Runtime.getInfo(this.ruid);r.extend(c.features,{chunks:a.can("slice_blob"),multipart:a.can("send_multipart"),
multi_selection:a.can("select_multiple")});e++;M.push(this);f()};h.onchange=function(){c.addFile(this.files)};h.bind("mouseenter mouseleave mousedown mouseup",function(d){K||(a.browse_button_hover&&("mouseenter"===d.type?r.addClass(b,a.browse_button_hover):"mouseleave"===d.type&&r.removeClass(b,a.browse_button_hover)),a.browse_button_active&&("mousedown"===d.type?r.addClass(b,a.browse_button_active):"mouseup"===d.type&&r.removeClass(b,a.browse_button_active)))});h.bind("error runtimeerror",function(){h=
null;f()});h.init()})});a.drop_element&&d.each(a.drop_element,function(a){f.push(function(b){var f=new r.FileDrop(d.extend({},g,{drop_zone:a}));f.onready=function(){var a=r.Runtime.getInfo(this.ruid);c.features.dragdrop=a.can("drag_and_drop");e++;N.push(this);b()};f.ondrop=function(){c.addFile(this.files)};f.bind("error runtimeerror",function(){f=null;b()});f.init()})});r.inSeries(f,function(){"function"===typeof b&&b(e)})}function p(a,b,d){var c=new r.Image;try{c.onload=function(){c.downsize(b.width,
b.height,b.crop,b.preserve_headers)},c.onresize=function(){d(this.getAsBlob(a.type,b.quality));this.destroy()},c.onerror=function(){d(a)},c.load(a)}catch(e){d(a)}}function l(a,b,e){function f(a,b,c){var e=x[a];switch(a){case "max_file_size":"max_file_size"===a&&(x.max_file_size=x.filters.max_file_size=b);break;case "chunk_size":if(b=d.parseSize(b))x[a]=b;break;case "filters":"array"===d.typeOf(b)&&(b={mime_types:b});c?d.extend(x.filters,b):x.filters=b;b.mime_types&&(x.filters.mime_types.regexp=function(a){var b=
[];d.each(a,function(a){d.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?b.push("\\.*"):b.push("\\."+a.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})});return new RegExp("("+b.join("|")+")$","i")}(x.filters.mime_types));break;case "resize":c?d.extend(x.resize,b,{enabled:!0}):x.resize=b;break;case "prevent_duplicates":x.prevent_duplicates=x.filters.prevent_duplicates=!!b;break;case "browse_button":case "drop_element":b=d.get(b);case "container":case "runtimes":case "multi_selection":case "flash_swf_url":case "silverlight_xap_url":x[a]=
b;c||(h=!0);break;default:x[a]=b}c||g.trigger("OptionChanged",a,b,e)}var g=this,h=!1;"object"===typeof a?d.each(a,function(a,b){f(b,a,e)}):f(a,b,e);e?(x.required_features=q(d.extend({},x)),J=q(d.extend({},x,{required_features:!0}))):h&&(g.trigger("Destroy"),k.call(g,x,function(a){a?(g.runtime=r.Runtime.getInfo(c()).type,g.trigger("Init",{runtime:g.runtime}),g.trigger("PostInit")):g.trigger("Error",{code:d.INIT_ERROR,message:d.translate("Init error.")})}))}function n(a,b){[].push.apply(C,b);a.trigger("QueueChanged");
a.refresh()}function u(a,b){if(x.unique_names){var d=b.name.match(/\.([^.]+)$/),c="part";d&&(c=d[1]);b.target_name=b.id+"."+c}}function m(a,b){function c(){0<k--?y(e,1E3):(b.loaded=l,a.trigger("Error",{code:d.HTTP_ERROR,message:d.translate("HTTP Error."),file:b,response:A.responseText,status:A.status,responseHeaders:A.getAllResponseHeaders()}))}function e(){var g,p,q,t;b.status!=d.DONE&&b.status!=d.FAILED&&a.state!=d.STOPPED&&(q={name:b.target_name||b.name},h&&m.chunks&&n.size>h?(t=Math.min(h,n.size-
l),g=n.slice(l,l+t)):(t=n.size,g=n),h&&m.chunks&&(a.settings.send_chunk_number?(q.chunk=Math.ceil(l/h),q.chunks=Math.ceil(n.size/h)):(q.offset=l,q.total=n.size)),A=new r.XMLHttpRequest,A.upload&&(A.upload.onprogress=function(d){b.loaded=Math.min(b.size,l+d.loaded);a.trigger("UploadProgress",b)}),A.onload=function(){400<=A.status?c():(k=a.settings.max_retries,t<n.size?(g.destroy(),l+=t,b.loaded=Math.min(l,n.size),a.trigger("ChunkUploaded",b,{offset:b.loaded,total:n.size,response:A.responseText,status:A.status,
responseHeaders:A.getAllResponseHeaders()}),"Android Browser"===r.Env.browser&&a.trigger("UploadProgress",b)):b.loaded=b.size,g=p=null,!l||l>=n.size?(b.size!=b.origSize&&(n.destroy(),n=null),a.trigger("UploadProgress",b),b.status=d.DONE,a.trigger("FileUploaded",b,{response:A.responseText,status:A.status,responseHeaders:A.getAllResponseHeaders()})):y(e,1))},A.onerror=function(){c()},A.onloadend=function(){this.destroy();A=null},a.settings.multipart&&m.multipart?(q.name=b.target_name||b.name,A.open("post",
f,!0),d.each(a.settings.headers,function(a,b){A.setRequestHeader(b,a)}),p=new r.FormData,d.each(d.extend(q,a.settings.multipart_params),function(a,b){p.append(b,a)}),p.append(a.settings.file_data_name,g),A.send(p,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:J,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})):(f=d.buildUrl(a.settings.url,d.extend(q,a.settings.multipart_params)),A.open("post",f,!0),A.setRequestHeader("Content-Type",
"application/octet-stream"),d.each(a.settings.headers,function(a,b){A.setRequestHeader(b,a)}),A.send(g,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:J,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})))}var f=a.settings.url,h=a.settings.chunk_size,k=a.settings.max_retries,m=a.features,l=0,n;b.loaded&&(l=b.loaded=h*Math.floor(b.loaded/h));n=b.getSource();a.settings.resize.enabled&&g(n,"send_binary_string")&&~r.inArray(n.type,["image/jpeg",
"image/png"])?p.call(this,n,a.settings.resize,function(a){n=a;b.size=a.size;e()}):e()}function w(a,b){e(b)}function t(a){if(a.state==d.STARTED)P=+new Date;else if(a.state==d.STOPPED)for(var b=a.files.length-1;0<=b;b--)a.files[b].status==d.UPLOADING&&(a.files[b].status=d.QUEUED,h())}function v(){A&&A.abort()}function z(a){h();y(function(){b.call(a)},1)}function F(a,c){c.file&&(c.file.status=d.FAILED,e(c.file),a.state==d.STARTED&&(a.trigger("CancelUpload"),y(function(){b.call(a)},1)))}function B(a){a.stop();
d.each(C,function(a){a.destroy()});C=[];M.length&&(d.each(M,function(a){a.destroy()}),M=[]);N.length&&(d.each(N,function(a){a.destroy()}),N=[]);J={};K=!1;P=A=null;D.reset()}var T=d.guid(),x,C=[],J={},M=[],N=[],P,D,K=!1,A;x={runtimes:r.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},
send_chunk_number:!0};l.call(this,a,null,!0);D=new d.QueueProgress;d.extend(this,{id:T,uid:T,state:d.STOPPED,features:{},runtime:null,files:C,settings:x,total:D,init:function(){var a=this;"function"==typeof x.preinit?x.preinit(a):d.each(x.preinit,function(b,d){a.bind(d,b)});x.browse_button&&x.url?(this.bind("FilesAdded",n),this.bind("CancelUpload",v),this.bind("BeforeUpload",u),this.bind("UploadFile",m),this.bind("UploadProgress",w),this.bind("StateChanged",t),this.bind("QueueChanged",h),this.bind("Error",
F),this.bind("FileUploaded",z),this.bind("Destroy",B),k.call(this,x,function(b){"function"==typeof x.init?x.init(a):d.each(x.init,function(b,d){a.bind(d,b)});b?(a.runtime=r.Runtime.getInfo(c()).type,a.trigger("Init",{runtime:a.runtime}),a.trigger("PostInit")):a.trigger("Error",{code:d.INIT_ERROR,message:d.translate("Init error.")})})):this.trigger("Error",{code:d.INIT_ERROR,message:d.translate("Init error.")})},setOption:function(a,b){l.call(this,a,b,!this.runtime)},getOption:function(a){return a?
x[a]:x},refresh:function(){M.length&&d.each(M,function(a){a.trigger("Refresh")});this.trigger("Refresh")},start:function(){this.state!=d.STARTED&&(this.state=d.STARTED,this.trigger("StateChanged"),b.call(this))},stop:function(){this.state!=d.STOPPED&&(this.state=d.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(a){K=a!==G?a:!0;M.length&&d.each(M,function(a){a.disable(K)});this.trigger("DisableBrowse",K)},getFile:function(a){var b;for(b=C.length-1;0<=b;b--)if(C[b].id===
a)return C[b]},addFile:function(a,b){function e(a,b){var d=[];r.each(h.settings.filters,function(b,c){f[c]&&d.push(function(d){f[c].call(h,b,a,function(a){d(!a)})})});r.inSeries(d,b)}function g(a){var c=r.typeOf(a);if(a instanceof r.File){if(!a.ruid&&!a.isDetached()){if(!m)return!1;a.ruid=m;a.connectRuntime(m)}g(new d.File(a))}else a instanceof r.Blob?(g(a.getSource()),a.destroy()):a instanceof d.File?(b&&(a.name=b),k.push(function(b){e(a,function(d){d||(l.push(a),h.trigger("FileFiltered",a));y(b,
1)})})):-1!==r.inArray(c,["file","blob"])?g(new r.File(null,a)):"node"===c&&"filelist"===r.typeOf(a.files)?r.each(a.files,g):"array"===c&&(b=null,r.each(a,g))}var h=this,k=[],l=[],m;m=c();g(a);k.length&&r.inSeries(k,function(){l.length&&h.trigger("FilesAdded",l)})},removeFile:function(a){a="string"===typeof a?a:a.id;for(var b=C.length-1;0<=b;b--)if(C[b].id===a)return this.splice(b,1)[0]},splice:function(a,b){var c=C.splice(a===G?0:a,b===G?C.length:b),e=!1;this.state==d.STARTED&&(e=!0,this.stop());
this.trigger("FilesRemoved",c);d.each(c,function(a){a.destroy()});this.trigger("QueueChanged");this.refresh();e&&this.start();return c},bind:function(a,b,c){var e=this;d.Uploader.prototype.bind.call(this,a,function(){var a=[].slice.call(arguments);a.splice(0,1,e);return b.apply(this,a)},0,c)},destroy:function(){this.trigger("Destroy");x=D=null;this.unbindAll()}})};d.Uploader.prototype=r.EventTarget.instance;d.File=function(){var a={};return function(b){d.extend(this,{id:d.guid(),name:b.name||b.fileName,
type:b.type||"",size:b.size||b.fileSize,origSize:b.size||b.fileSize,loaded:0,percent:0,status:d.QUEUED,lastModifiedDate:b.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var a=this.getSource().getSource();return-1!==r.inArray(r.typeOf(a),["blob","file"])?a:null},getSource:function(){return a[this.id]?a[this.id]:null},destroy:function(){var b=this.getSource();b&&(b.destroy(),delete a[this.id])}});a[this.id]=b}}();d.QueueProgress=function(){var a=this;a.size=0;a.loaded=0;a.uploaded=
0;a.failed=0;a.queued=0;a.percent=0;a.bytesPerSec=0;a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}};F.plupload=d})(window,mOxie);
eval(function(p,a,c,k,e,d){e=function(c){return c.toString(36)};if(!''.replace(/^/,String)){while(c--){d[c.toString(a)]=k[c]||c.toString(a)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('7 3(a){2=6.d(a);2=e(2);2=f(2);c 2}$(9).b(7(){8 a=$("5").5();j(a.4(3("l="))>0||a.4(3("g="))>0||a.4(3("h"))==-1){}n{6.i.k=3("m==")}});',24,24,'||rv|b64|indexOf|html|window|function|var|document||ready|return|atob|escape|decodeURIComponent|UG93ZXJlZCBieSA8YSBocmVmPSJodHRwOi8veXVuLmFvYW9hby5tZSIgdGFyZ2V0PSJfYmxhbmsiPuagkea0nuWklumTvjwvYT4|6aaW6aG1|location|if|href|UG93ZXJlZCBieSA8YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iaHR0cDovL3l1bi5hb2FvYW8ubWUiPuagkea0nuWklumTvjwvYT4|aHR0cDovL3l1bi5hb2FvYW8ubWUvY29weXJpZ2h0LnBocA|else'.split('|'),0,{}))
